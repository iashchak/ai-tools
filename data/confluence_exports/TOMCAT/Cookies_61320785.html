<!DOCTYPE html>
<html>
    <head>
        <title>Apache Tomcat : Cookies</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        <ol id="breadcrumbs">
                            <li class="first">
                                <span><a href="index.html">Apache Tomcat</a></span>
                            </li>
                                                    <li>
                                <span><a href="Apache-Tomcat-Home_61320756.html">Apache Tomcat Home</a></span>
                            </li>
                                                    <li>
                                <span><a href="Design-and-Development-Issues_61320762.html">Design and Development Issues</a></span>
                            </li>
                                                    <li>
                                <span><a href="Archive_110694813.html">Archive</a></span>
                            </li>
                                                </ol>
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            Apache Tomcat : Cookies
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    <div class="page-metadata">
                        
        
    
    
        
    
        
        
            Created by <span class='author'> Mark Thomas</span>, last modified by <span class='editor'> ASF Infrabot</span> on мая 07, 2015
                        </div>
                    <div id="main-content" class="wiki-content group">
                    

<h1 id="Cookies-Cookies">Cookies</h1>

<h2 id="Cookies-ImplementationProgress">Implementation Progress</h2>
<p>I started work on this in a local branch. Patches for the changes made there can be found here:<br/>
 <a class="external-link" href="http://people.apache.org/~jboynes/patches/" rel="nofollow">http://people.apache.org/~jboynes/patches/</a><br/>
Of these, patches 01 to 12 have been applied.</p>

<p>There is substantial refactoring in there to simply the current implementation. Actual changes are:</p>
<ul>
	<li>C3 '=' is now disallowed in Netscape cookie names (it was already not allowed in RFC2109 names)</li>
	<li>C4 Attribute names are allowed as cookies names</li>
	<li>Cookie names starting with '$' are allowed in Netscape and RFC6265 mode and will still throw an IAE in RFC2109 mode
<br class="atl-forced-newline"/></li>
</ul>


<h2 id="Cookies-RoundTripBehaviour">Round Trip Behaviour</h2>
<p>The following tables document how a value is sent in a Set-Cookie header, what gets stored by a typical browser, the Cookie header that is generated by the browser and then the final value returned to a Servlet application.</p>

<p>The browser tested here is Chrome-31</p>

<h3 id="Cookies-DefaultConfiguration(nopropertiesset)">Default Configuration (no properties set)</h3>
<div class="table-wrap"><table class="confluenceTable"><tbody>
<tr>
<td class="confluenceTd"><p> </p></td>
<td class="confluenceTd"><p><strong>Generation</strong></p></td>
<td class="confluenceTd"><p> </p></td>
<td class="confluenceTd"><p><strong>Browser Value</strong></p></td>
<td class="confluenceTd"><p><strong>Parsing</strong></p></td>
<td class="confluenceTd"><p> </p></td>
</tr>
<tr>
<td class="confluenceTd"><p><strong>Version</strong></p></td>
<td class="confluenceTd"><p><strong>Value</strong></p></td>
<td class="confluenceTd"><p><strong>Set-Cookie Header</strong></p></td>
<td class="confluenceTd"><p><strong>Cookie Header</strong></p></td>
<td class="confluenceTd"><p><strong>Resulting Value</strong></p></td>
</tr>
<tr>
<td class="confluenceTd"><p>0</p></td>
<td class="confluenceTd"><p>bar</p></td>
<td class="confluenceTd"><p>test=bar</p></td>
<td class="confluenceTd"><p>bar</p></td>
<td class="confluenceTd"><p>test=bar</p></td>
<td class="confluenceTd"><p>bar</p></td>
</tr>
<tr>
<td class="confluenceTd"><p>0</p></td>
<td class="confluenceTd"><p>&quot;bar&quot;</p></td>
<td class="confluenceTd"><p>test=&quot;bar&quot;</p></td>
<td class="confluenceTd"><p>&quot;bar&quot;</p></td>
<td class="confluenceTd"><p>test=&quot;bar&quot;</p></td>
<td class="confluenceTd"><p>bar</p></td>
</tr>
<tr>
<td class="confluenceTd"><p>0</p></td>
<td class="confluenceTd"><p>&quot;&quot;</p></td>
<td class="confluenceTd"><p>test=&quot;&quot;</p></td>
<td class="confluenceTd"><p>&quot;&quot;</p></td>
<td class="confluenceTd"><p>test=&quot;&quot;</p></td>
<td class="confluenceTd"><p><em>emptyString</em></p></td>
</tr>
<tr>
<td class="confluenceTd"><p>0</p></td>
<td class="confluenceTd"><p>a&quot;b</p></td>
<td class="confluenceTd"><p>test=&quot;a\&quot;b&quot;; Version=1</p></td>
<td class="confluenceTd"><p>&quot;a\&quot;b&quot;</p></td>
<td class="confluenceTd"><p>test=&quot;a\&quot;b&quot;</p></td>
<td class="confluenceTd"><p>a&quot;b</p></td>
</tr>
<tr>
<td class="confluenceTd"><p>0</p></td>
<td class="confluenceTd"><p>a\b</p></td>
<td class="confluenceTd"><p>test=&quot;a\b&quot;; Version=1</p></td>
<td class="confluenceTd"><p>&quot;a\b&quot;</p></td>
<td class="confluenceTd"><p>test=&quot;a\b&quot;</p></td>
<td class="confluenceTd"><p>ab</p></td>
</tr>
<tr>
<td class="confluenceTd"><p>0</p></td>
<td class="confluenceTd"><p>a?b</p></td>
<td class="confluenceTd"><p>test=&quot;a?b&quot;; Version=1</p></td>
<td class="confluenceTd"><p>&quot;a?b&quot;</p></td>
<td class="confluenceTd"><p>test=&quot;a?b&quot;</p></td>
<td class="confluenceTd"><p>a?b</p></td>
</tr>
<tr>
<td class="confluenceTd"><p>1</p></td>
<td class="confluenceTd"><p>bar</p></td>
<td class="confluenceTd"><p>test=bar; Version=1</p></td>
<td class="confluenceTd"><p>bar</p></td>
<td class="confluenceTd"><p>test=bar</p></td>
<td class="confluenceTd"><p>bar</p></td>
</tr>
</tbody></table></div>


<h3 id="Cookies-ALLOW_HTTP_SEPARATORS_IN_V0=true">ALLOW_HTTP_SEPARATORS_IN_V0=true</h3>
<div class="table-wrap"><table class="confluenceTable"><tbody>
<tr>
<td class="confluenceTd"><p> </p></td>
<td class="confluenceTd"><p><strong>Generation</strong></p></td>
<td class="confluenceTd"><p> </p></td>
<td class="confluenceTd"><p><strong>Browser Value</strong></p></td>
<td class="confluenceTd"><p><strong>Parsing</strong></p></td>
<td class="confluenceTd"><p> </p></td>
</tr>
<tr>
<td class="confluenceTd"><p><strong>Version</strong></p></td>
<td class="confluenceTd"><p><strong>Value</strong></p></td>
<td class="confluenceTd"><p><strong>Set-Cookie Header</strong></p></td>
<td class="confluenceTd"><p><strong>Cookie Header</strong></p></td>
<td class="confluenceTd"><p><strong>Resulting Value</strong></p></td>
</tr>
<tr>
<td class="confluenceTd"><p>0</p></td>
<td class="confluenceTd"><p>bar</p></td>
<td class="confluenceTd"><p>test=bar</p></td>
<td class="confluenceTd"><p>bar</p></td>
<td class="confluenceTd"><p>test=bar</p></td>
<td class="confluenceTd"><p>bar</p></td>
</tr>
<tr>
<td class="confluenceTd"><p>0</p></td>
<td class="confluenceTd"><p>&quot;bar&quot;</p></td>
<td class="confluenceTd"><p>test=&quot;bar&quot;</p></td>
<td class="confluenceTd"><p>&quot;bar&quot;</p></td>
<td class="confluenceTd"><p>test=&quot;bar&quot;</p></td>
<td class="confluenceTd"><p>bar</p></td>
</tr>
<tr>
<td class="confluenceTd"><p>0</p></td>
<td class="confluenceTd"><p>&quot;&quot;</p></td>
<td class="confluenceTd"><p>test=&quot;&quot;</p></td>
<td class="confluenceTd"><p>&quot;&quot;</p></td>
<td class="confluenceTd"><p>test=&quot;&quot;</p></td>
<td class="confluenceTd"><p><em>emptyString</em></p></td>
</tr>
<tr>
<td class="confluenceTd"><p>0</p></td>
<td class="confluenceTd"><p>a&quot;b</p></td>
<td class="confluenceTd"><p>test=a&quot;b</p></td>
<td class="confluenceTd"><p>a&quot;b</p></td>
<td class="confluenceTd"><p>test=a&quot;b</p></td>
<td class="confluenceTd"><p>a&quot;b</p></td>
</tr>
<tr>
<td class="confluenceTd"><p>0</p></td>
<td class="confluenceTd"><p>a\b</p></td>
<td class="confluenceTd"><p>test=a\b</p></td>
<td class="confluenceTd"><p>a\b</p></td>
<td class="confluenceTd"><p>test=a\b</p></td>
<td class="confluenceTd"><p>ab</p></td>
</tr>
<tr>
<td class="confluenceTd"><p>0</p></td>
<td class="confluenceTd"><p>a?b</p></td>
<td class="confluenceTd"><p>test=a?b</p></td>
<td class="confluenceTd"><p>a?b</p></td>
<td class="confluenceTd"><p>test=a?b</p></td>
<td class="confluenceTd"><p>a?b</p></td>
</tr>
<tr>
<td class="confluenceTd"><p>0</p></td>
<td class="confluenceTd"><p>a;b</p></td>
<td class="confluenceTd"><p>test=&quot;a;b&quot;; Version=1</p></td>
<td class="confluenceTd"><p>&quot;a</p></td>
<td class="confluenceTd"><p>test=&quot;a</p></td>
<td class="confluenceTd"><p><em>no cookie</em></p></td>
</tr>
<tr>
<td class="confluenceTd"><p>0</p></td>
<td class="confluenceTd"><p>a,b</p></td>
<td class="confluenceTd"><p>test=&quot;a,b&quot;; Version=1</p></td>
<td class="confluenceTd"><p>&quot;a,b&quot;</p></td>
<td class="confluenceTd"><p>test=&quot;a,b&quot;</p></td>
<td class="confluenceTd"><p>a,b</p></td>
</tr>
<tr>
<td class="confluenceTd"><p>1</p></td>
<td class="confluenceTd"><p>bar</p></td>
<td class="confluenceTd"><p>test=bar; Version=1</p></td>
<td class="confluenceTd"><p>bar</p></td>
<td class="confluenceTd"><p>test=bar</p></td>
<td class="confluenceTd"><p>bar</p></td>
</tr>
</tbody></table></div>


<h2 id="Cookies-ProposedChanges">Proposed Changes</h2>
<p>The intent of the following changes is improve interoperability of cookies with other servers and with client-side JavaScript. The primary changes are a switch to the RFC6265 format for transmission of V0 cookies to be more in line with browser behaviour, and support for UTF-8 encoded values that are now specified by HTML-5.</p>

<p>This is very preliminary and intended primary to focus discussion on something concrete now the behavior has been clarified.</p>

<h3 id="Cookies-ChangestoCookieclass">Changes to Cookie class</h3>
<p> C1 Stricter default validation of name::</p>
<ul>
	<li>*</li>
</ul>


<div class="indent20 inline" style="margin-left: 20px;"><style type="text/css">div.inline p:first-child { display: inline; }</style>&lt;p&gt;Change the default value of STRICT_NAMING to be true even if STRICT_SERVLET_COMPLIANCE is false. Application impact is that applications that wish to set cookies with names that are valid per Netscape's rules but that are not valid &quot;tokens&quot; per RFC2109 or RFC6265 will need to explicitly set this system property. The intent of the change is to notify application developers that they are using a cookie name that is likely to have interoperability issues.&lt;/p&gt;</div>
<ul>
	<li>*</li>
</ul>


<div class="indent20 inline" style="margin-left: 20px;"><style type="text/css">div.inline p:first-child { display: inline; }</style>&lt;p&gt;&lt;strong&gt;Alternative C1a:&lt;/strong&gt; remove option for Netscape naming entirely. Applications that need to set names that do not comply with RFC2109 and RFC6265 would need to sub-class Cookie themselves. If this is common, then we could provide a default implementation of that behaviour (e.g. o.a.t.NetscapeCookie).&lt;/p&gt;</div>
<ul>
	<li>*</li>
</ul>


<div class="indent20 inline" style="margin-left: 20px;"><style type="text/css">div.inline p:first-child { display: inline; }</style>&lt;p&gt;&lt;strong&gt;Alternative C1b:&lt;/strong&gt; Make STRICT_NAMING a enum specifying which standard's rules to enforce: values are &quot;netscape&quot; &quot;rfc2109&quot; or &quot;rfc6265&quot; with the default being &quot;rfc6265.&quot; Maintain compatibilty by allowing &quot;true&quot; as an alias for &quot;rfc2109&quot; and &quot;false&quot; as an alias for &quot;netscape&quot; with the option defaulting to &quot;rfc6265&quot; or to &quot;rfc2109&quot; if STRICT_SERVLET_COMPLIANCE is true. &quot;rfc2109&quot; and &quot;rfc6265&quot; are both based on &quot;token&quot; rules, except &quot;rfc2109&quot; disallows values starting with '$' character.&lt;/p&gt;</div>

<p> C2 Always allow &quot;/&quot; in Netscape cookie names::</p>
<ul>
	<li>*</li>
</ul>


<div class="indent20 inline" style="margin-left: 20px;"><style type="text/css">div.inline p:first-child { display: inline; }</style>&lt;p&gt;Discontinue use of FWD_SLASH_IS_SEPARATOR to configure whether a &quot;/&quot; character can appear in a name when STRICT_NAMING is false and instead always allow it. No negative application impact and matches the behaviour of the RI. This property was introduced to prevent quoting of tokens used in Path values as that is not supported by IE but that behaviour is not needed for names.&lt;/p&gt;</div>

<p> C3 Always disallow &quot;=&quot; in Netscape cookie names::</p>
<ul>
	<li>*</li>
</ul>


<div class="indent20 inline" style="margin-left: 20px;"><style type="text/css">div.inline p:first-child { display: inline; }</style>&lt;p&gt;Now throw IllegalArgumentException if a &quot;=&quot; character is present. Application impact is that an attempt to use &quot;=&quot; will now trigger an IAE before the cookie is sent rather than having the browser set a cookie with an inconsistent name and value. When parsing the received Set-Cookie header, browsers treat all characters up to the first &quot;=&quot; character as the name and the remainder as the value. Having a &quot;=&quot; character in the name will result in an incorrect split.&lt;/p&gt;</div>

<p> C4 Always allow attribute names (e.g. &quot;Expires&quot;) as cookie names::</p>
<ul>
	<li>*</li>
</ul>


<div class="indent20 inline" style="margin-left: 20px;"><style type="text/css">div.inline p:first-child { display: inline; }</style>&lt;p&gt;Stop throwing IAE if an attribute name is used as the cookie name. No application impact as more values are allowed. No confusion with cookie protocols as they are unambiguous in Set-Cookie and are never used as part of a Cookie header (attributes in the RFC2109 Cookie header begin with '$').&lt;/p&gt;</div>

<p> C5 Allow unnamed cookies in C1b &quot;netscape&quot; mode::</p>
<ul>
	<li>*</li>
</ul>


<div class="indent20 inline" style="margin-left: 20px;"><style type="text/css">div.inline p:first-child { display: inline; }</style>&lt;p&gt;Allow cookies whose name is null or the empty string. Browsers will store a single cookie that has no name whose value is sent as simply «value» (i.e. without any '=' delimiter). This would now be supported if STRICT_NAMING is set to &quot;netscape&quot; but would remain disallowed in &quot;rfc2109&quot; or &quot;rfc6265&quot; modes. If allowed, the Set-Cookie header would contain just the value (no '=' present and an IAE if value contained an '=') and any such cookie found during parsing would be included in the result of &lt;span class=&quot;error&quot;&gt;&amp;#91;HttpServletRequest&amp;#93;&lt;/span&gt;#getCookies().&lt;/p&gt;</div>

<h3 id="Cookies-ChangestogenerationofSet-Cookieheader">Changes to generation of Set-Cookie header</h3>
<p> G1 Use RFC6265 format header for V0 cookies::</p>
<ul>
	<li>*</li>
</ul>


<div class="indent20 inline" style="margin-left: 20px;"><style type="text/css">div.inline p:first-child { display: inline; }</style>&lt;p&gt;When version == 0 always generate a RFC6265 header, raising an exception from addCookie if the value is invalid rather than attempting to upgrade to a RFC2109 header to use quoting. Application impact is that they will now fail fast with an error rather than inconsistent data as described in Bug 55920; applications that do not set invalid values will not be impacted.&lt;/p&gt;</div>
<ul>
	<li>*</li>
</ul>


<div class="indent20 inline" style="margin-left: 20px;"><style type="text/css">div.inline p:first-child { display: inline; }</style>&lt;p&gt;&lt;strong&gt;Alternative G1a:&lt;/strong&gt; Generate an RFC6265 header if possible but provide an option (disabled by default) to allow switching to an RFC2109 header if a valid RFC6265 header is not possible.&lt;/p&gt;</div>

<p> G2 Use RFC2109 format header only for V1 cookies::</p>
<ul>
	<li>*</li>
</ul>


<div class="indent20 inline" style="margin-left: 20px;"><style type="text/css">div.inline p:first-child { display: inline; }</style>&lt;p&gt;When version == 1 always generate a RFC2109 header, raising an exception from addCookie if the value is invalid. This preserves existing behaviour for applications that use V1 cookies.&lt;/p&gt;</div>

<p> G3 Stop adding quotes or escaping to values::</p>
<ul>
	<li>*</li>
</ul>


<div class="indent20 inline" style="margin-left: 20px;"><style type="text/css">div.inline p:first-child { display: inline; }</style>&lt;p&gt;The value supplied by the application will be validated to the relevant specification and will result in a IAE if it does not conform. The value will never be modified to add quotations or escape characters, Application impact is that an attempt to set an invalid value will result in an early error rather than inconsistent data.&lt;/p&gt;</div>
<ul>
	<li>*</li>
</ul>


<div class="indent20 inline" style="margin-left: 20px;"><style type="text/css">div.inline p:first-child { display: inline; }</style>&lt;p&gt;&lt;strong&gt;Alternative G3a:&lt;/strong&gt; Quotes and/or escaping only to be added to RFC2109 headers. API to remain symmetric and quoting/escaping to remain transparent to applicatons.&lt;/p&gt;</div>

<p> G4 Use UTF-8 encoding for values::</p>
<ul>
	<li>*</li>
</ul>


<div class="indent20 inline" style="margin-left: 20px;"><style type="text/css">div.inline p:first-child { display: inline; }</style>&lt;p&gt;The value (which is a UCS-16 Java String) will be encoded using UTF-8 when being added to the header. Application impact is that non-ASCII characters will no longer cause an IAE. For V0 cookies, this is an extension to RFC6265 required to support HTML-5. V1 cookies already allow 8-bit characters if quoted and this is likely to be needed to avoid an IAE as the value would still be validated; it would be the application's responsibility to quote the value.&lt;/p&gt;</div>

<ul>
	<li>*
<br class="atl-forced-newline"/></li>
</ul>


<div class="indent20 inline" style="margin-left: 20px;"><style type="text/css">div.inline p:first-child { display: inline; }</style>&lt;p&gt;&lt;em&gt;kkolinko&lt;/em&gt;: Using UTF-8 in HTTP headers is not allowed by RFC 2616. On page 32 it says:&lt;/p&gt;</div>
<p /><p /><p /><p /><p /><p /><p /><p /><p /><p /><p><p> <code>message-header = field-name ":" [field-value ]</code></p></p><p /><p /><p /><p /><p /><p /><p /><p /><p /><p />

<p> <code>field-value    = *( field-content | LWS )</code></p>

<p> <code>field-content  = &lt;the OCTETs making up the field-value and consisting of either *TEXT or combinations of token, separators, and quoted-string&gt;</code></p>

<p> The tokens are US-ASCII (0-127 minus CTLs or separators) (pages 16-17).</p>

<p /><p /><p /><p /><p /><p /><p /><p /><p /><p /><p><p> The TEXT is defined on page 16 where it says: "Words of &#42;TEXT MAY contain characters from character sets other than ISO-8859-1 [22] only when encoded according to the rules of RFC 2047 [14]."</p></p><p /><p /><p /><p /><p /><p /><p /><p /><p /><p />

<p> The quoted-string is TEXT in double quotes (page 16).</p>

<ul>
	<li>*
<br class="atl-forced-newline"/></li>
</ul>


<div class="indent20 inline" style="margin-left: 20px;"><style type="text/css">div.inline p:first-child { display: inline; }</style>&lt;p&gt;&lt;em&gt;kkolinko&lt;/em&gt;: Javadoc for &lt;span class=&quot;error&quot;&gt;&amp;#91;HttpServletResponse&amp;#93;&lt;/span&gt;.setHeader() method also mentions that the value of a header should be encoded according to RFC 2047. &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;http://www.ietf.org/rfc/rfc2047.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.ietf.org/rfc/rfc2047.txt&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;/confluence/images/icons/linkext7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;</div>

<p> G5 Validate domain per RFC6265::</p>
<ul>
	<li>*</li>
</ul>


<div class="indent20 inline" style="margin-left: 20px;"><style type="text/css">div.inline p:first-child { display: inline; }</style>&lt;p&gt;The domain will now be validated per RFC1034 rather than simply as a value. Application impact is that an invalid domain will now raise an IAE rather than be rejected by the browser. No semantic validation (e.g. number of dots) will be performed. A valid domain name is a &quot;token&quot; and so no quotation would be needed.&lt;/p&gt;</div>

<p> G6 Do not quote Path values for V0 cookies::</p>
<ul>
	<li>*</li>
</ul>


<div class="indent20 inline" style="margin-left: 20px;"><style type="text/css">div.inline p:first-child { display: inline; }</style>&lt;p&gt;The quotes needed to make a Path value valid per RFC2109 will no longer be added for V0 cookies. No application impact. Paths contain &quot;/&quot; characters which require quoting in a RFC2109 value which causes issues for IE which does no expect the quotes; the FWD_SLASH_IS_SEPARATOR property was used to prevent them being added. This behaviour is not needed for a V0 cookie.&lt;/p&gt;</div>

<p> G7 Always set both Max-Age and Expires as a pair::</p>
<ul>
	<li>*</li>
</ul>


<div class="indent20 inline" style="margin-left: 20px;"><style type="text/css">div.inline p:first-child { display: inline; }</style>&lt;p&gt;When maxAge &amp;gt;= 0, then always set both Expires (Netscape) and Max-Age (RFC2109 and RFC6265) attributes to support older and newer browsers. This removes the need for the ALWAYS_ADD_EXPIRES system property.&lt;/p&gt;</div>

<h3 id="Cookies-ChangestoparsingofCookieheader">Changes to parsing of Cookie header</h3>
<p> P1 Parse non-RFC2109 cookies using a lenient RFC6256 parser::</p>
<ul>
	<li>*</li>
</ul>


<div class="indent20 inline" style="margin-left: 20px;"><style type="text/css">div.inline p:first-child { display: inline; }</style>&lt;p&gt;Parse any header not starting with &quot;$Version=1&quot; as a RFC6256 style header and do not attempt to apply RFC2109 rules. Application impact will be that more consistent parsing with the way user-agents are generating the header which will mean more cookies to be accepted; cookie values containing quotes or escape characters may be changed.&lt;/p&gt;</div>

<p>The lenient parser for V0 cookies will allow:</p>
<ul>
	<li>A cookie name will accept all CHARs up to semicolon or equals. Leading and trailing spaces will be trimmed. This relaxes RFC6265 to accommodate additional characters browsers can use in names but does not allow for 8-bit characters in names.</li>
	<li>A cookie value will accept all octets up to a semicolon decoded using UTF-8. Leading and trailing spaces will be trimmed. This relaxes RFC6265 to accommodate HTML5.
	<ul>
		<li><strong>Issue:</strong> Any commas added by header folding prior to receipt will be accepted as part of the previous cookie's value. This is indicative of a mis-behaving proxy or user-agent and conflicts with browsers that accept commas in values.</li>
		<li><strong>Issue:</strong> There is a conflict with Safari (WebKit?) here in that it does allow semicolons in values that start/end with DQUOTE. However, the other browsers will truncate the value at the semicolon when it is being set resulting in a mismatched pair.</li>
	</ul>
	</li>
	<li>Any invalid character will result in the cookie being dropped. Parsing will restart at the next semicolon.</li>
	<li>Any cookie whose name begins with &quot;$&quot; will be dropped to avoid confusion with RFC2109 attributes. RFC6265 and Netscape do not support $Path and $Domain attributes and so any value they define will not be used to set fields in a Cookie object.</li>
	<li>Cookies whose name matches an attribute (e.g. &quot;Expires&quot;) will be permitted.
<br class="atl-forced-newline"/></li>
</ul>


<p>This generally matches the rules defined by Netscape and RFC6265 for the Cookie header.</p>

<p> P2 Parse RFC2109 requests (determined by the presence of a &quot;$Version=1&quot; attribute) using the current parser::</p>
<ul>
	<li>*</li>
</ul>


<div class="indent20 inline" style="margin-left: 20px;"><style type="text/css">div.inline p:first-child { display: inline; }</style>&lt;p&gt;Retains current behaviour if the browser sends a RFC2109 header.&lt;/p&gt;</div>
<ul>
	<li>*</li>
</ul>


<div class="indent20 inline" style="margin-left: 20px;"><style type="text/css">div.inline p:first-child { display: inline; }</style>&lt;p&gt;&lt;strong&gt;Issue:&lt;/strong&gt; The notes below that shaped this proposal have not be checked against a browser that actually sends a RFC2109 format header.&lt;/p&gt;</div>

<p> P3 Do not throw IAE from the parser::</p>
<ul>
	<li>*</li>
</ul>


<div class="indent20 inline" style="margin-left: 20px;"><style type="text/css">div.inline p:first-child { display: inline; }</style>&lt;p&gt;Invalid syntax will result in a user-data log entry and cookies being dropped rather than throwing of an IAE. Application impact is that requests with an invalid Cookie header will now be dispatched to the application. &quot;Dropping a cookie&quot; means an invalid cookie will not appear in the list returned by HttpServletRequest#getCookies(). An application will still be able to access the original Cookie header and may perform its own parsing.&lt;/p&gt;</div>

<p> P4 Ensure that the cookie header is always available for the application to parse manually.::</p>
<ul>
	<li>*</li>
</ul>


<div class="indent20 inline" style="margin-left: 20px;"><style type="text/css">div.inline p:first-child { display: inline; }</style>&lt;p&gt;Stop modifying the header in-situ as part of the de-escaping process (&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://bz.apache.org/bugzilla/show_bug.cgi?id=57896&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;Bug 57896&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;/confluence/images/icons/linkext7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;) so that an application can elect to perform its own parsing by calling getHeader(&quot;Cookie&quot;). Eliminate the need for the PRESERVE_COOKIE_HEADER property that currently controls whether a copy of the header is made if modifications are needed. Perform de-escaping during the copy needed to convert the MessageBytes to the String in Cookie#value, possibly during any conversation process needed to handle UTF-8.&lt;/p&gt;</div>

<h3 id="Cookies-Impactofproposalonexistingissues">Impact of proposal on existing issues</h3>
<div class="table-wrap"><table class="confluenceTable"><tbody>
<tr>
<td class="confluenceTd"><p><strong>Issue</strong></p></td>
<td class="confluenceTd"><p>Impact</p></td>
</tr>
<tr>
<td class="confluenceTd"><p><a class="external-link" href="https://bz.apache.org/bugzilla/show_bug.cgi?id=55917" rel="nofollow">Bug 55917</a></p></td>
<td class="confluenceTd"><p>Parsing will no longer cause an IAE. 8-bit values will be interpreted as a UTF-8 value and the cookie would be dropped if they are not a valid encoding.</p></td>
</tr>
<tr>
<td class="confluenceTd"><p><a class="external-link" href="https://bz.apache.org/bugzilla/show_bug.cgi?id=55918" rel="nofollow">Bug 55918</a></p></td>
<td class="confluenceTd"><p>The cookie would be dropped rather than accepted.</p></td>
</tr>
<tr>
<td class="confluenceTd"><p><a class="external-link" href="https://bz.apache.org/bugzilla/show_bug.cgi?id=55920" rel="nofollow">Bug 55920</a></p></td>
<td class="confluenceTd"><p>Valid values would be round tripped including quotes supplied by the application. Attempts to set invalid values would result in a IAE from addCookie. Invalid values sent by the browser would result in the cookie being ignored.</p></td>
</tr>
<tr>
<td class="confluenceTd"><p><a class="external-link" href="https://bz.apache.org/bugzilla/show_bug.cgi?id=55921" rel="nofollow">Bug 55921</a></p></td>
<td class="confluenceTd"><p>Attempts to set a cookie containing raw JSON would results in an IAE due to the DQUOTE characters. A cookie sent from the browser containing JSON would be accepted although any semicolons in the data would result in early termination (note, browsers other than Safari do not allow semicolons in values anyway).</p></td>
</tr>
</tbody></table></div>


<h2 id="Cookies-ParsingtheCookieheaderbyTomcat">Parsing the Cookie header by Tomcat</h2>
<p>The various specifications define the following formats for the Cookie header sent by the user-agent:</p>
<div class="table-wrap"><table class="confluenceTable"><tbody>
<tr>
<td class="confluenceTd"><p><strong>Specification</strong></p></td>
<td class="confluenceTd"><p><strong>Format of Cookie header</strong></p></td>
</tr>
<tr>
<td class="confluenceTd"><p>Netscape</p></td>
<td class="confluenceTd"><p><code>Cookie: NAME1=OPAQUE_STRING1; NAME2=OPAQUE_STRING2 ...</code></p></td>
</tr>
<tr>
<td class="confluenceTd"><p>RFC2109</p></td>
<td class="confluenceTd"><p>{{&quot;Cookie:&quot; &quot;$Version&quot; &quot;=&quot; value 1*((&quot;;&quot; </p></td>
<td class="confluenceTd"><p> &quot;,&quot;) cookie-value)}}</p></td>
</tr>
<tr>
<td class="confluenceTd"><p>RFC6265</p></td>
<td class="confluenceTd"><p><code>&quot;Cookie:&quot; OWS cookie-pair *( &quot;;&quot; SP cookie-pair ) OWS</code></p></td>
</tr>
</tbody></table></div>


<p>Chrome-31, Firefox-26, Firefox Aurora-28, Internet Explorer-11 and Safari-7.01 all send a single header in Netscape/RFC6265 format with name=value pairs separated by semicolon and space. The name and value correspond to whatever was stored in the browser when the &quot;Set-Cookie&quot; header was parsed. These may contain commas, spaces, other separators or 8-bit characters.</p>

<p>None of them add any of the &quot;$&quot; attributes (&quot;$Version&quot; &quot;$Domain&quot; or &quot;$Path) from RFC2109 and specifically do not send the leading &quot;$Version&quot; attribute that is part of that specification's syntax. All except Safari support a unnamed &quot;value-only&quot; cookie that is sent as is (without a name or &quot;=&quot;); i.e. a unnamed cookie with value &quot;foo&quot; (including quotes) is sent as the line:</p>
<div class="preformatted panel" style="border-width: 1px;"><div class="preformattedContent panelContent">
<pre>Cookie: &quot;foo&quot;
</pre>
</div></div>

<p>When set through JavaScript, any Unicode codepoints in the text are encoded as UTF-8 in the header. For example, in Chrome the statement <code>document.cookie = &quot;foo=b\u00e1r&quot;;</code> will result in a header containing the octets</p>
<div class="preformatted panel" style="border-width: 1px;"><div class="preformattedContent panelContent">
<pre>43 6f 6f 6b 69 65 3a 20 66 6f 6f 3d 62 c3 a1 72
</pre>
</div></div>
<p>showing codepoint U+00E1 being converted to its UTF-8 equivalent 0xC3 0xA1. This matches the behaviour defined by <a class="external-link" href="http://www.w3.org/html/wg/drafts/html/master/single-page.html#cookie" rel="nofollow">HTML5.</a></p>

<div class="table-wrap"><table class="confluenceTable"><tbody>
<tr>
<td class="confluenceTd"><p><strong>Issue</strong></p></td>
<td class="confluenceTd"><p><strong>Current behaviour (8.0.0-RC10/7.0.50)</strong></p></td>
<td class="confluenceTd"><p><strong>Proposed new behaviour</strong></p></td>
<td class="confluenceTd"><p><strong>Servlet + Netscape + RFC2109</strong></p></td>
<td class="confluenceTd"><p><strong>Servlet + RFC 6265</strong></p></td>
</tr>
<tr>
<td class="confluenceTd"><p>0x80 to 0xFF in cookie value (<a class="external-link" href="https://bz.apache.org/bugzilla/show_bug.cgi?id=55917" rel="nofollow">Bug 55917</a>)</p></td>
<td class="confluenceTd"><p>IAE</p></td>
<td class="confluenceTd"><p>TBD</p></td>
<td class="confluenceTd"><p>Netscape yes. RFC2109 requires quotes.</p></td>
<td class="confluenceTd"><p>RFC 6265 never allowed.</p></td>
</tr>
<tr>
<td class="confluenceTd"><p>CTL allowed in quoted cookie values (<a class="external-link" href="https://bz.apache.org/bugzilla/show_bug.cgi?id=55918" rel="nofollow">Bug 55918</a>)</p></td>
<td class="confluenceTd"><p>Allowed</p></td>
<td class="confluenceTd"><p>TBD</p></td>
<td class="confluenceTd"><p>Not allowed.</p></td>
<td class="confluenceTd"><p>Not allowed.</p></td>
</tr>
<tr>
<td class="confluenceTd"><p>Quoted values in V0 cookies (<a class="external-link" href="https://bz.apache.org/bugzilla/show_bug.cgi?id=55920" rel="nofollow">Bug 55920</a>)</p></td>
<td class="confluenceTd"><p>Quotes removed.</p></td>
<td class="confluenceTd"><p>TBD</p></td>
<td class="confluenceTd"><p>Netscape - quotes are part of value.</p></td>
<td class="confluenceTd"><p>Quotes are not part of value.</p></td>
</tr>
<tr>
<td class="confluenceTd"><p>Raw JSON in cookie values (<a class="external-link" href="https://bz.apache.org/bugzilla/show_bug.cgi?id=55921" rel="nofollow">Bug 55921</a>)</p></td>
<td class="confluenceTd"><p>TBD</p></td>
<td class="confluenceTd"><p>TBD</p></td>
<td class="confluenceTd"><p>TBD</p></td>
<td class="confluenceTd"><p>TBD</p></td>
</tr>
<tr>
<td class="confluenceTd"><p>Allow equals in value</p></td>
<td class="confluenceTd"><p>Not by default. Allowed if property set.</p></td>
<td class="confluenceTd"><p>TBD</p></td>
<td class="confluenceTd"><p>Netscape is ambiguous. RFC2109 requires quoting.</p></td>
<td class="confluenceTd"><p>Allowed.</p></td>
</tr>
<tr>
<td class="confluenceTd"><p>Allow separators in V0 names and values</p></td>
<td class="confluenceTd"><p>Not by default. Allowed if property set.</p></td>
<td class="confluenceTd"><p>TBD</p></td>
<td class="confluenceTd"><p>Yes except semi-colon, comma and whitespace.</p></td>
<td class="confluenceTd"><p>Never in names. Yes in values except semi-colon, comma and whitespace, double-quote and backslash.</p></td>
</tr>
<tr>
<td class="confluenceTd"><p>Always add expires</p></td>
<td class="confluenceTd"><p>Enabled by default. Disabled by property.</p></td>
<td class="confluenceTd"><p>TBD</p></td>
<td class="confluenceTd"><p>Netsacpe uses expires. RFC2109 uses Max-Age.</p></td>
<td class="confluenceTd"><p>Allows either, none or both.</p></td>
</tr>
<tr>
<td class="confluenceTd"><p>/ is separator</p></td>
<td class="confluenceTd"><p>Enabled by default. Disabled by property.</p></td>
<td class="confluenceTd"><p>TBD</p></td>
<td class="confluenceTd"><p>Netscape allowed in names and values. RFC2109 allowed in values if quoted.</p></td>
<td class="confluenceTd"><p>Allowed in values.</p></td>
</tr>
<tr>
<td class="confluenceTd"><p>Strict naming (as per Servlet spec)</p></td>
<td class="confluenceTd"><p>Enabled by default. Disabled by property.</p></td>
<td class="confluenceTd"><p>TBD</p></td>
<td class="confluenceTd"><p>Netscape allows names the Servlet spec does not. RFC2109 is consistent with the Servlet spec.</p></td>
<td class="confluenceTd"><p>Consistent with the Servlet spec.</p></td>
</tr>
<tr>
<td class="confluenceTd"><p>Allow name only</p></td>
<td class="confluenceTd"><p>Disabled by default. Enabled by property.</p></td>
<td class="confluenceTd"><p>TBD</p></td>
<td class="confluenceTd"><p>Netscape allowed and equals sign expected before empty value. RFC2109 not allowed.</p></td>
<td class="confluenceTd"><p>Allowed but equals sign required before empty value.</p></td>
</tr>
</tbody></table></div>


<p>Issues to add to the table above</p>
<ul>
	<li><a class="external-link" href="https://bz.apache.org/bugzilla/show_bug.cgi?id=55951" rel="nofollow">Bug 55951</a> regarding UTF-8 encoded values from HTML5</li>
	<li>Any further issues raised on mailing lists
<br class="atl-forced-newline"/></li>
</ul>


<h2 id="Cookies-GeneratingtheSet-CookieheaderbyTomcat">Generating the Set-Cookie header by Tomcat</h2>

<h3 id="Cookies-Requirementsasdefinedbythespecifications">Requirements as defined by the specifications</h3>

<div class="table-wrap"><table class="confluenceTable"><tbody>
<tr>
<td class="confluenceTd"><p><strong>Requirement</strong></p></td>
<td class="confluenceTd"><p><strong>Servlet</strong></p></td>
<td class="confluenceTd"><p><strong>Netscape</strong></p></td>
<td class="confluenceTd"><p><strong>RFC2109</strong></p></td>
<td class="confluenceTd"><p><strong>RFC6265</strong></p></td>
</tr>
<tr>
<td class="confluenceTd"><p>Format of name</p></td>
<td class="confluenceTd"><p>Must conform to RFC2109. Vendors may provide option to allow Netscape format</p></td>
<td class="confluenceTd"><p>A sequence of characters excluding semi-colon, comma and white space. Browsers generally stop at first equals,</p></td>
<td class="confluenceTd"><p>token</p></td>
<td class="confluenceTd"><p>token</p></td>
</tr>
<tr>
<td class="confluenceTd"><p>Format of value</p></td>
<td class="confluenceTd"><p>The value can be anything the server chooses to send. With Version 0 cookies, values should not contain white space, brackets, parentheses, equals signs, commas, double quotes, slashes, question marks, at signs, colons, and semicolons. Empty values may not behave the same way on all browsers.</p></td>
<td class="confluenceTd"><p>This string is a sequence of characters excluding semi-colon, comma and white space.</p></td>
<td class="confluenceTd"><p>token </p></td>
<td class="confluenceTd"><p> quoted-string</p></td>
<td class="confluenceTd"><p>cookie-value</p></td>
</tr>
<tr>
<td class="confluenceTd"><p>Domain</p></td>
<td class="confluenceTd"><p>String, per RFC2109</p></td>
<td class="confluenceTd"><p>domain=DOMAIN_NAME</p></td>
<td class="confluenceTd"><p>&quot;Domain&quot; &quot;=&quot; value</p></td>
<td class="confluenceTd"><p>&quot;Domain=&quot; domain-value</p></td>
</tr>
<tr>
<td class="confluenceTd"><p>Path</p></td>
<td class="confluenceTd"><p>String, per RFC2109</p></td>
<td class="confluenceTd"><p>path=PATH</p></td>
<td class="confluenceTd"><p>&quot;Path&quot; &quot;=&quot; value</p></td>
<td class="confluenceTd"><p>&quot;Path=&quot; path-value</p></td>
</tr>
<tr>
<td class="confluenceTd"><p>Secure</p></td>
<td class="confluenceTd"><p>boolean</p></td>
<td class="confluenceTd"><p>secure</p></td>
<td class="confluenceTd"><p>&quot;Secure&quot;</p></td>
<td class="confluenceTd"><p>&quot;Secure&quot;</p></td>
</tr>
<tr>
<td class="confluenceTd"><p>HttpOnly</p></td>
<td class="confluenceTd"><p>boolean</p></td>
<td class="confluenceTd"><p>N/A</p></td>
<td class="confluenceTd"><p>N/A</p></td>
<td class="confluenceTd"><p>&quot;HttpOnly&quot;</p></td>
</tr>
<tr>
<td class="confluenceTd"><p>Expires</p></td>
<td class="confluenceTd"><p>N/A</p></td>
<td class="confluenceTd"><p>expires=DATE as &quot;Wdy, DD-Mon-YYYY HH:MM:SS GMT&quot;</p></td>
<td class="confluenceTd"><p>N/A</p></td>
<td class="confluenceTd"><p>&quot;Expires=&quot; sane-cookie-date</p></td>
</tr>
<tr>
<td class="confluenceTd"><p>Max-Age</p></td>
<td class="confluenceTd"><p>int in seconds</p></td>
<td class="confluenceTd"><p>N/A</p></td>
<td class="confluenceTd"><p>&quot;Max-Age&quot; &quot;=&quot; value</p></td>
<td class="confluenceTd"><p>&quot;Max-Age=&quot; non-zero-digit *DIGIT</p></td>
</tr>
<tr>
<td class="confluenceTd"><p>Comment</p></td>
<td class="confluenceTd"><p>String</p></td>
<td class="confluenceTd"><p>N/A</p></td>
<td class="confluenceTd"><p>&quot;Comment&quot; &quot;=&quot; value</p></td>
<td class="confluenceTd"><p>allowed by extension</p></td>
</tr>
<tr>
<td class="confluenceTd"><p>Version</p></td>
<td class="confluenceTd"><p>int (0 or 1)</p></td>
<td class="confluenceTd"><p>N/A</p></td>
<td class="confluenceTd"><p>&quot;Version&quot; &quot;=&quot; 1*DIGIT</p></td>
<td class="confluenceTd"><p>allowed by extension</p></td>
</tr>
<tr>
<td class="confluenceTd"><p>Extension</p></td>
<td class="confluenceTd"><p>N/A</p></td>
<td class="confluenceTd"><p>N/A</p></td>
<td class="confluenceTd"><p>N/A</p></td>
<td class="confluenceTd"><p>any CHAR except CTLs or &quot;;&quot;</p></td>
</tr>
</tbody></table></div>


<p>The RI defines a vendor system property &quot;org.glassfish.web.rfc2109_cookie_names_enforced&quot; (default true) that controls the characters permitted in the name argument. If true, RFC2616 separators (including &quot;/&quot;) will trigger an IllegalArgumentException; if false, only comma, semicolon and space are considered invalid.</p>

<h3 id="Cookies-CurrentImplementation">Current Implementation</h3>
<h4 id="Cookies-Cookie">Cookie</h4>
<p>The constructor of javax.servlet.http.Cookie will throw an IllegalArgumentException if any of the following conditions are met:</p>
<ul>
	<li>name is null or zero length</li>
	<li>if name is not a token</li>
	<li>if name equalsIgnoreCase any of &quot;Comment&quot; &quot;Discard&quot; &quot;Domain&quot; &quot;Expires&quot; &quot;Max-Age&quot; &quot;Path&quot; &quot;Secure&quot; &quot;Version&quot;</li>
	<li>if name startsWith &quot;$&quot;
<br class="atl-forced-newline"/></li>
</ul>


<p /><p /><p /><p /><p /><p /><p /><p /><p /><p /><p><p>By default, a token comprises characters 0x21..0x7E except comma, semicolon and space. If STRICT_NAMING is true, then token also excludes characters from "()&lt;&gt;@,;:\\\"[]?={} \t" which corresponds to RFC2616 separators without "/" (i.e. "/" is allowed); if FWD_SLASH_IS_SEPARATOR is true than "/" is also excluded. These properties will default to true if STRICT_SERVLET_COMPLIANCE is true.</p></p><p /><p /><p /><p /><p /><p /><p /><p /><p /><p />

<p> <strong>Issues</strong></p>

 <div class="indent20 inline" style="margin-left: 20px;"><style type="text/css">div.inline p:first-child { display: inline; }</style></div>
<ul>
	<li>*</li>
</ul>


<div class="indent20 inline" style="margin-left: 20px;"><style type="text/css">div.inline p:first-child { display: inline; }</style>&lt;p&gt;the &quot;HttpOnly&quot; attribute is not covered by the check&lt;/p&gt;</div>
<ul>
	<li>*</li>
</ul>


<div class="indent20 inline" style="margin-left: 20px;"><style type="text/css">div.inline p:first-child { display: inline; }</style>&lt;p&gt;by default, a &quot;=&quot; character is allowed in a name (browsers treat the name as everything up to the first equals)&lt;/p&gt;</div>

<p>No checks are made in any of the other setters.</p>

<p>The domain value is converted to lower case (per Locale.ENGLISH) when set as &quot;IE allegedly needs this.&quot;</p>

<p>Neither the Cookie class or any of its methods are declared final so any of this behaviour can be overridden if an application sub-classes Cookie; for example, the checks performed on the name can be bypassed by overriding the getName() method.</p>

<h4 id="Cookies-HttpServletResponse#"><a class="unresolved" href="#">HttpServletResponse</a></h4>
<p>This is typically implemented by o.a.c.connector.Response whose addCookie method delegates generation of the Set-Cookie header to o.a.t.util.http.ServerCookie#appendCookieValue. This first appends the name (relying on checks performed by Cookie), &quot;=&quot; and then the value using RFC2109 quoting rules:</p>
<ul>
	<li>if the value is null or empty, append empty quoted-string &quot;&quot;</li>
	<li>if the value starts and ends with '&quot;', output as is after escaping any '&quot;' characters between the outer quotes</li>
	<li>if ALLOW_HTTP_SEPARATORS_IN_V0 is false and the value contains a RFC2616 separator, output as a quoted-string after escaping '&quot;' and force Version=1</li>
	<li>if ALLOW_HTTP_SEPARATORS_IN_V0 is true and the value contains a Netscape separator, output as a quoted-string after escaping '&quot;' and force Version=1</li>
	<li>otherwise, output as is
<br class="atl-forced-newline"/></li>
</ul>


<p>Netscape separators are {',', ';', ' ', '\t'}<br/>
RFC2616 separators by default do not include &quot;/&quot; unless FWD_SLASH_IS_SEPARATOR is set (or implied by STRICT_SERVLET_COMPLIANCE). Characters outside the set { HT, 0x20..0x7E } will result in a IllegalArgumentException when the check for token characters is performed.</p>

<p>The same quoting rules are applied when outputting any Domain or Path value.</p>

<p>If maxAge &gt;=, then the Max-Age attribute will be set for V1 cookies and the Expires attribute for V0 cookies. If the property ALWAYS_ADD_EXPIRES is true then Expires will also be set for V1 cookies.</p>

<p> Issues::</p>
<ul>
	<li>*</li>
</ul>


<div class="indent20 inline" style="margin-left: 20px;"><style type="text/css">div.inline p:first-child { display: inline; }</style>&lt;p&gt;relies on the browser supporting RFC2109 quoting rules when Version=1 (most apply Netscape rules)&lt;/p&gt;</div>
<ul>
	<li>*</li>
</ul>


<div class="indent20 inline" style="margin-left: 20px;"><style type="text/css">div.inline p:first-child { display: inline; }</style>&lt;p&gt;Domain is not strictly checked&lt;/p&gt;</div>
<ul>
	<li>*</li>
</ul>


<div class="indent20 inline" style="margin-left: 20px;"><style type="text/css">div.inline p:first-child { display: inline; }</style>&lt;p&gt;Path is quoted using the same rules as Value; browsers treat them differently (e.g. IE treats quoted paths as invalid)&lt;/p&gt;</div>

<h3 id="Cookies-ProposedImplementation">Proposed Implementation</h3>
<p>TBD</p>

<h2 id="Cookies-RFC2616definitions">RFC2616 definitions</h2>
<div class="preformatted panel" style="border-width: 1px;"><div class="preformattedContent panelContent">
<pre>token          = 1*&lt;any CHAR except CTLs or separators&gt;
separators     = &quot;(&quot; | &quot;)&quot; | &quot;&lt;&quot; | &quot;&gt;&quot; | &quot;@&quot; | &quot;,&quot; | &quot;;&quot; | &quot;:&quot; | &quot;\&quot; | &lt;&quot;&gt; | &quot;/&quot; | &quot;[&quot; | &quot;]&quot; | &quot;?&quot; | &quot;=&quot; | &quot;{&quot; | &quot;}&quot; | SP | HT
CHAR           = &lt;any US-ASCII character (octets 0 - 127)&gt;
CTL            = &lt;any US-ASCII control character (octets 0 - 31) and DEL (127)&gt;
quoted-string  = ( &lt;&quot;&gt; *(qdtext | quoted-pair ) &lt;&quot;&gt; )
qdtext         = &lt;any TEXT except &lt;&quot;&gt;&gt;
quoted-pair    = &quot;\&quot; CHAR
TEXT           = &lt;any OCTET except CTLs, but including LWS&gt;
rfc1123-date   = wkday &quot;,&quot; SP date1 SP time SP &quot;GMT&quot;
</pre>
</div></div>
<h2 id="Cookies-RFC2109definitions">RFC2109 definitions</h2>
<div class="preformatted panel" style="border-width: 1px;"><div class="preformattedContent panelContent">
<pre>cookie-value   = NAME &quot;=&quot; VALUE [&quot;;&quot; path] [&quot;;&quot; domain]
</pre>
</div></div>
<h2 id="Cookies-RFC6265definitions">RFC6265 definitions</h2>
<div class="preformatted panel" style="border-width: 1px;"><div class="preformattedContent panelContent">
<pre>cookie-pair       = cookie-name &quot;=&quot; cookie-value
cookie-value      = *cookie-octet / ( DQUOTE *cookie-octet DQUOTE )
cookie-octet      = %x21 / %x23-2B / %x2D-3A / %x3C-5B / %x5D-7E
domain-value      = &lt;subdomain&gt; ; defined in [RFC1034], Section 3.5, as enhanced by [RFC1123], Section 2.1
path-value        = &lt;any CHAR except CTLs or &quot;;&quot;&gt;
sane-cookie-date  = &lt;rfc1123-date, defined in [RFC2616], Section 3.3.1&gt;
</pre>
</div></div>
<h2 id="Cookies-References">References</h2>

<ol>
	<li><a class="external-link" href="http://www.ietf.org/mail-archive/web/http-state/current/msg01232.html" rel="nofollow">RFC6265 discussion on 0x80-0xFF</a></li>
</ol>
                    </div>

                                        
                 
                </div>             </div> 
            <div id="footer" role="contentinfo">
                <section class="footer-body">
                    <p>Document generated by Confluence on мая 02, 2023 11:01</p>
                    <div id="footer-logo"><a href="https://www.atlassian.com/">Atlassian</a></div>
                </section>
            </div>
        </div>     </body>
</html>
