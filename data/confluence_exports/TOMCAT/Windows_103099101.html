<!DOCTYPE html>
<html>
    <head>
        <title>Apache Tomcat : Windows</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        <ol id="breadcrumbs">
                            <li class="first">
                                <span><a href="index.html">Apache Tomcat</a></span>
                            </li>
                                                    <li>
                                <span><a href="Apache-Tomcat-Home_61320756.html">Apache Tomcat Home</a></span>
                            </li>
                                                    <li>
                                <span><a href="FAQ_103098750.html">FAQ</a></span>
                            </li>
                                                </ol>
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            Apache Tomcat : Windows
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    <div class="page-metadata">
                        
        
    
    
        
    
        
        
            Created by <span class='author'> ASF Infrabot</span>, last modified by <span class='editor'> Konstantin Kolinko</span> on ноя 25, 2019
                        </div>
                    <div id="main-content" class="wiki-content group">
                    <p><em>Permalink</em> to this page: <a href="https://cwiki.apache.org/confluence/x/3SolBg" rel="nofollow">https://cwiki.apache.org/confluence/x/3SolBg</a></p><h2 id="Windows-Preface">Preface</h2><p>This page addresses various issues related to running Tomcat on a Windows platform. Please see the <a href="UsefulLinks_103100724.html">UsefulLinks</a> for more links related to Windows.</p><h2 id="Windows-Questions">Questions</h2><ol><li><a href="#Windows-Q1">Why do I get Out of Environment Space?</a></li><li><a href="#Windows-Q2">When I start up tomcat (or when it is running), I get the error java.lang.IllegalMonitorStateException: current thread not owner</a></li><li><a href="#Windows-Q3">Can I turn off case sensitivity?</a></li><li><a href="#Windows-Q4">Can I use NTLM authentication?</a></li><li><a href="#Windows-Q5">I want to redeploy web applications, how do I prevent resources from getting locked?</a></li><li><a href="#Windows-Q6">Can I use UNC paths?</a></li><li><a href="#Windows-Q7">Why can't Tomcat see my mapped drive when running as a service?</a></li><li><a href="#Windows-Q8">Why aren't access logs showing up in Tomcat on Vista?</a></li><li><a href="#Windows-Q9">Why do I get a &quot;HTTP/1.x 400 No Host matches server name&quot; error when I change the &quot;webapps&quot; folder in Tomcat on Vista?</a></li><li><a href="#Windows-Q10">How do I add or customize a Windows Service for Tomcat?</a></li><li><a href="#Windows-Q11">What are tomcat9w.exe/tomcat9.exe (or tomcat7w.exe/tomcat7.exe etc..) ?</a></li></ol><h2 id="Windows-Answers">Answers</h2><h3 id="Windows-Q1WhydoIgetOutofEnvironmentSpace?"><span class="confluence-anchor-link" id="Windows-Q1"></span>Why do I get Out of Environment Space?</h3><p>Check the Tomcat README, and <a class="external-link" href="https://marc.info/?l=tomcat-user&amp;m=103918210305702&amp;w=2" rel="nofollow">this link</a></p><h3 id="Windows-Q2WhenIstartuptomcat(orwhenitisrunning),Igettheerrorjava.lang.IllegalMonitorStateException:currentthreadnotowner"><span class="confluence-anchor-link" id="Windows-Q2"></span>When I start up tomcat (or when it is running), I get the error java.lang.IllegalMonitorStateException: current thread not owner</h3><p>That weird issue was observed many years ago and now is a history. See the <a class="external-link" href="https://bz.apache.org/bugzilla/show_bug.cgi?id=13723" rel="nofollow">Tomcat Bug Report #13723</a> and <a class="external-link" href="https://bugs.java.com/bugdatabase/view_bug.do?bug_id=4776385" rel="nofollow">Sun Bug Parade report #4776385</a> for the answer.</p><h3 id="Windows-Q3CanIturnoffcasesensitivity?"><span class="confluence-anchor-link" id="Windows-Q3"></span>Can I turn off case sensitivity?</h3><p>It is <a class="external-link" href="https://tomcat.apache.org/tomcat-6.0-doc/config/context.html" rel="nofollow">possible</a> in Tomcat 6 and earlier, but not recommended.</p><h3 id="Windows-Q4CanIuseNTLMauthentication?"><span class="confluence-anchor-link" id="Windows-Q4"></span>Can I use NTLM authentication?</h3><p>Yes.</p><ul><li><a class="external-link" href="http://waffle.codeplex.com/" rel="nofollow">Waffle/JNA</a> (obsolete)</li><li><a class="external-link" href="http://tomcatspnego.codeplex.com/" rel="nofollow">Tomcat SPNEGO</a> (obsolete)</li><li><a class="external-link" href="http://spnego.sourceforge.net/" rel="nofollow">SPNEGO SF</a></li><li><a class="external-link" href="http://www.ioplex.com/jespa.html" rel="nofollow">Jespa</a> (commercial)</li><li><a class="external-link" href="https://tomcat.apache.org/connectors-doc/webserver_howto/iis.html" rel="nofollow">Tomcat IIS Connector</a></li><li><a class="external-link" href="http://jcifs.samba.org/src/docs/ntlmhttpauth.html" rel="nofollow">Samba JCIFs</a> (obsolete, no NTLMv2)</li></ul><h3 id="Windows-Q5Iwanttoredeploywebapplications,howdoIpreventresourcesfromgettinglocked?"><span class="confluence-anchor-link" id="Windows-Q5"></span>I want to redeploy web applications, how do I prevent resources from getting locked?</h3><p>Most locking issues will occur with JARs from /WEB-INF/lib, and are usually caused by access through URLs. Tomcat has mechanisms to allow avoiding locking.</p><p>Since Tomcat 5.0, a mechanism exists to prevent locking when accessing resources using the getResource method of the URLClassLoader. Many applications, such as Xerces, do not set the use of caching to false before opening the URL connection to a JAR file, and that causes locking. In Tomcat 5.5, this mechanism is disabled by default (as it has a non negligible influence on startup times, and is often useless), and can be enabled using the <code>antiJARLocking</code> attribute of the <a class="external-link" href="https://tomcat.apache.org/tomcat-9.0-doc/config/context.html" rel="nofollow">Context</a> element. If getResource call occurs, resources inside the JARs will be extracted to the work directory of the web application. There is an alternative to this since Tomcat 6.0.24: you can configure a <a class="external-link" href="https://tomcat.apache.org/tomcat-9.0-doc/api/org/apache/catalina/core/JreMemoryLeakPreventionListener.html" rel="nofollow">JreMemoryLeakPreventionListener</a> in your <code>server.xml</code> and it will set the URL connection caching to be off by default.</p><p>There is another lock prevention mechanism in Tomcat 5.5 (<code>antiResourceLocking</code> attribute), which will cause the web application files to be copied to the temp folder and run from this location. This has a larger impact on web application startup times, but obviously prevents locking on all resources of the web application. This also allows more flexible management operations as none of the web application resources will be locked, even while the web application is running (as a special note, when making changes to JSPs without reloading the application, the changes have to be duplicated to the path where the web application resources have been copied in the temp folder).</p><h3 id="Windows-Q6CanIuseUNCpaths?"><span class="confluence-anchor-link" id="Windows-Q6"></span>Can I use UNC paths?</h3><p>Yes. Make sure that the user that Tomcat is running as is able to access the path. This is particularly important when running Tomcat as a service since the local service account will <strong>not</strong> have the necessary permissions.</p><h3 id="Windows-Q7Whycan&#39;tTomcatseemymappeddrivewhenrunningasaservice?"><span class="confluence-anchor-link" id="Windows-Q7"></span>Why can't Tomcat see my mapped drive when running as a service?</h3><p>The mapped drives are part of a user's profile and they are not used when running as a service. You should be OK with UNC paths.</p><h3 id="Windows-Q8Whyaren&#39;taccesslogsshowingupinTomcatonVista?"><span class="confluence-anchor-link" id="Windows-Q8"></span>Why aren't access logs showing up in Tomcat on Vista?</h3><p>By default, the Tomcat Windows Service installer attempts to place Tomcat inside the &quot;Program Files&quot; folder. Default Vista folder permissions cause various logging functions (though mysteriously not every log function) to fail silently. It is best to change Tomcat's install folder to something like &quot;C:\Tomcat&quot;. This issue can be hard to spot because by default the access logs are not enabled and the example webapps work just fine.</p><h3 id="Windows-Q9WhydoIgeta&quot;HTTP/1.x400NoHostmatchesservername&quot;errorwhenIchangethe&quot;webapps&quot;folderinTomcatonVista?"><span class="confluence-anchor-link" id="Windows-Q9"></span>Why do I get a &quot;HTTP/1.x 400 No Host matches server name&quot; error when I change the &quot;webapps&quot; folder in Tomcat on Vista?</h3><p>By default, the Tomcat Windows Service installer attempts to place Tomcat inside the &quot;Program Files&quot; folder. Default Vista folder permissions conflict with the contents of the &quot;webapps&quot; folder, can case a blank page to come up when attempting to access the webapp. By using a HTTP Header inspector like &quot;<a class="external-link" href="https://addons.mozilla.org/en-US/firefox/addon/3829" rel="nofollow">Live HTTP Headers</a>&quot; you can see a slightly more descriptive error message. It is best to change Tomcat's install folder to something like &quot;C:\Tomcat&quot;. This issue can be hard to spot because by default the example webapps work just fine.</p><h3 id="Windows-Q10HowdoIaddorcustomizeaWindowsServiceforTomcat?"><span class="confluence-anchor-link" id="Windows-Q10"></span>How do I add or customize a Windows Service for Tomcat?</h3><p>Tomcat uses the Apache Commons Daemon. You can read its documentation at <a class="external-link" href="https://commons.apache.org/proper/commons-daemon/procrun.html" rel="nofollow">https://commons.apache.org/proper/commons-daemon/procrun.html</a> As a short example, you can create a new Windows Service with the full version number in its name like this:</p><p><code>bin\tomcat6.exe //IS//tomcat6026 --DisplayName &quot;Apache Tomcat 6.0.26&quot;</code></p><p>See also the <code>service.bat</code> file that comes in the <code>*-windows-&lt;arch&gt;</code>.zip distributions of Tomcat.</p><h3 id="Windows-Q11Whataretomcat9w.exe/tomcat9.exe(ortomcat7w.exe/tomcat7.exeetc..)?"><span class="confluence-anchor-link" id="Windows-Q11"></span>What are tomcat9w.exe/tomcat9.exe (or tomcat7w.exe/tomcat7.exe etc..)?</h3><p>Questions on this topic come regularly at various levels. So this is a longish explanation meant basically for real Tomcat/Windows beginners. Apologies in advance for any shortcuts and approximations. You can sort this out by yourself according to your own needs.</p><p>Java is a programming language designed to be &quot;compile once, run anywhere&quot;. The idea is that when you compile a java program, the java compiler creates a &quot;java bytecode&quot; version of your java program, and this bytecode version can be run by any Java Virtual Machine (a JVM) which runs on any platform (iow under any operating system) where such a JVM has been ported. Microsoft Windows is such a platform, and there exists a JVM which runs on it. Tomcat is a java application, and when it runs on a Windows platform, what really runs as a Windows process is the JVM, which in turn executes the bytecode of the compiled Tomcat application.</p><p>Because the JVM has to run on many different platforms, it cannot be too specific for each platform. For example under Windows, the JVM is not very good at running as a Windows Service. Windows Services are supposed to respond in specific ways to &quot;signals&quot; (or &quot;messages&quot;) sent by the Windows Services Manager, and the Windows JVM does not really implement the code needed to do that.</p><p>To make the JVM really capable to respond to such Windows signals/messages, one solution is to run the JVM inside of a &quot;wrapper&quot; program which is written in such a way that it does respond properly to Windows signals/messages, passes these signals to the JVM in a way which the JVM understands, and returns appropriate messages to the Windows Services Manager to indicate that the JVM started or stopped properly.</p><p>The Apache &quot;procrun&quot; software project provides such a wrapper program. Its original documentation can be found here: <a class="external-link" href="https://commons.apache.org/proper/commons-daemon/procrun.html" rel="nofollow">https://commons.apache.org/proper/commons-daemon/procrun.html</a>. But this documentation is more of the &quot;reference&quot; type : good for someone who already knows what they are looking for, but not very good as an introduction; and it doesn't explain what tomcat7w.exe (or tomcat6w.exe or tomcat5w.exe) and tomcat7.exe (or tomcat6.exe or tomcat5.exe) really are. From there this FAQ entry.</p><p>tomcat7.exe is in fact a renamed copy of the &quot;prunsrv&quot; program from the procrun project. This is the &quot;wrapper&quot; mentioned previously. When you install Tomcat as a Windows Service, what you are really installing is the prunsrv program, renamed as tomcat7.exe. This is the program that Windows knows as being the Tomcat Service, and it will send to this program the messages telling the Tomcat Service to start or stop. In turn, tomcat7.exe will run the JVM, and it will translate for the JVM these Windows messages. And the JVM will run Tomcat. Through this subterfuge, Windows will see a Windows Service application named &quot;Apache Tomcat&quot;, which runs as a Windows Service and which responds properly to Windows Service messages.</p><p>So what is tomcat7w.exe then ? It is a renamed version of the procrun &quot;prunmgr&quot; program. This is in fact a simple graphical Windows Registry editor, which is able to set and modify specific keys and values in the Registry; and these specific keys/values are the ones which are read by tomcat7.exe (the JVM wrapper program mentioned earlier).</p><p>When tomcat7.exe launches a JVM, it can pass to this JVM a number of &quot;command-line options&quot; (things such as &quot;-Xmx&quot;, &quot;-Dxxx&quot; and so on). To know which command-line options to pass, it reads specific keys/values in the Windows Registry. And these keys/values are the ones which you can set/modify via the tomcat7w.exe program.</p><p>One more thing: because the tomcat7.exe wrapper program actually &quot;runs&quot; the JVM, it must match the type of JVM that it runs, in terms of 32bit/64bit version. If you try to start a 64-bit JVM with a 32-bit tomcat7.exe, it won't work, and vice-versa. This is why there are several versions of the tomcat7.exe program: one 32-bit version and one 64-bit version.</p><p>The 64-bit version is for the widely used &quot;AMD64&quot;/&quot;x86-64&quot; architecture (x64). If you have a 64-bit processor it is likely that you want to use this one. (Some time ago there was another 64-bit version provided as well: the one for the &quot;Intel Itanium&quot; architecture &quot;IA-64&quot; (i64). It was discontinued). You must install and use the correct one matching the JVM that you are using.</p><p>The Tomcat Service installer for Windows normally bundles all three versions of the service wrapper and selects one for you automatically, according to the JRE instance that you selected during installation. The ZIP distributions of Tomcat contain only one version of the program, so you have to select the correct distributive to download (*-windows-x86.zip or *-windows-x64.zip).</p><p><br/></p><p><br/></p>
                    </div>

                                        
                 
                </div>             </div> 
            <div id="footer" role="contentinfo">
                <section class="footer-body">
                    <p>Document generated by Confluence on мая 02, 2023 11:01</p>
                    <div id="footer-logo"><a href="https://www.atlassian.com/">Atlassian</a></div>
                </section>
            </div>
        </div>     </body>
</html>
