<!DOCTYPE html>
<html>
    <head>
        <title>Apache Tomcat : Logging</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        <ol id="breadcrumbs">
                            <li class="first">
                                <span><a href="index.html">Apache Tomcat</a></span>
                            </li>
                                                    <li>
                                <span><a href="Apache-Tomcat-Home_61320756.html">Apache Tomcat Home</a></span>
                            </li>
                                                    <li>
                                <span><a href="FAQ_103098750.html">FAQ</a></span>
                            </li>
                                                </ol>
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            Apache Tomcat : Logging
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    <div class="page-metadata">
                        
        
    
    
        
    
        
        
            Created by <span class='author'> ASF Infrabot</span>, last modified by <span class='editor'> Konstantin Kolinko</span> on ноя 25, 2019
                        </div>
                    <div id="main-content" class="wiki-content group">
                    <p><em>Permalink</em> to this page: <a href="https://cwiki.apache.org/confluence/x/KiolBg" rel="nofollow">https://cwiki.apache.org/confluence/x/KiolBg</a></p><h2 id="Logging-Preface">Preface</h2><p>This FAQ section provides help with logging-related issues.</p><p>As you read these questions, please keep in mind that Tomcat's internal logging is separate from your own webapp's logging. You would typically be concerned only with your own webapp's logging. You would modify Tomcat's internal logging settings if you are debugging a possible issue or running into other problems. It is anticipated that Tomcat's out-of-the-box logging configuration will be fine for the vast majority of users and environments.</p><h2 id="Logging-Questions">Questions</h2><ol><li><a href="#Logging-Q1">Does Tomcat have built-in logging capabilities, and if so how do I use them?</a></li><li><a href="#Logging-Q2">What role does commons-logging play in logging?</a></li><li><a href="#Logging-Q3">What role does JULI and log4j play in logging?</a></li><li><a href="#Logging-Q4">How do I configure commons-logging for use with Tomcat?</a></li><li><a href="#Logging-Q5">How should I log in my own webapps?</a></li><li><a href="#Logging-Q6">Where does System.out go?</a></li><li><a href="#Logging-Q10">How do I rotate catalina.out</a>?</li><li><a href="#Logging-Q7">Where are the logs when running Tomcat as a Windows service?</a></li><li><a href="#Logging-Q8">How do I customize the location of the tomcat logging.properties file?</a></li><li><a href="#Logging-Q9">Since java.logging is the default commons-logging implementation in Tomcat, why is it not working in my Linux distribution?</a></li></ol><h2 id="Logging-Answers">Answers</h2><h3 id="Logging-Q1DoesTomcathavebuilt-inloggingcapabilities,andifsohowdoIusethem?"><span class="confluence-anchor-link" id="Logging-Q1"></span>Does Tomcat have built-in logging capabilities, and if so how do I use them?</h3><p>The Servlet Specification requires Servlet Containers like Tomcat to provide at least a rudimentary implementation of the <code>ServletContext#log</code> method. Tomcat provides a much richer implementation than required by the Spec, as follows:</p><ul><li>Prior to Tomcat 5.5, Tomcat provided a Logger element that you could configure and extend according to your needs.</li><li>Starting with Tomcat 5.5, Logger was removed and <a class="external-link" href="https://commons.apache.org/proper/commons-logging/" rel="nofollow">Apache Commons-Logging</a> <code>Log</code> is used everywhere in Tomcat. Read the Commons-Logging documentation if you'd like to know how to better use and configure Tomcat's internal logging. See also <a class="external-link" href="https://tomcat.apache.org/tomcat-9.0-doc/logging.html" rel="nofollow">https://tomcat.apache.org/tomcat-9.0-doc/logging.html</a></li><li>In Tomcat 7 (and also 6), the logging code is based on a set of classes interacting with the <a class="external-link" href="https://docs.oracle.com/javase/8/docs/api/java/util/logging/package-summary.html" rel="nofollow">java.util.logging API</a> (JUL), which comes with Java since version 1.4. The Tomcat startup script configures the JVM to use a web-application-aware implementation of the <a class="external-link" href="https://docs.oracle.com/javase/8/docs/api/java/util/logging/LogManager.html" rel="nofollow">JUL LogManager</a>. This Tomcat logging infrastructure is called JULI, and one can still distinguish its Apache Commons Logging heritage, but the complex configuration has been edited out and the package name changed.</li></ul><p>Web applications can get logging service by using the Servlet API logging (which not recommended), the JUL interface (which ultimately goes to JULI) or any other preferred interface for which they furnish the jar files and the appropriate configuration (see the respective descriptions for <a class="external-link" href="https://logging.apache.org/log4j/2.x/" rel="nofollow">Log4J</a>, <a class="external-link" href="http://www.slf4j.org/" rel="nofollow">SLF4J</a>, <a class="external-link" href="http://logback.qos.ch/" rel="nofollow">logback</a> or <a class="external-link" href="https://commons.apache.org/proper/commons-logging/" rel="nofollow">Apache Commons Logging</a> for example).</p><p>To additionally log information about requests going to the web application, &quot;Valves&quot; can be configured in the server.xml file, as described in detail <a class="external-link" href="https://tomcat.apache.org/tomcat-9.0-doc/config/valve.html" rel="nofollow">here</a>. For example, inside the &lt;Engine&gt; tag:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: xml; gutter: false; theme: Default" data-theme="Default">
&lt;Valve className=&quot;org.apache.catalina.valves.AccessLogValve&quot;
	directory=&quot;logs&quot;  prefix=&quot;localhost_access_log.&quot; suffix=&quot;.log&quot; pattern=&quot;common&quot; resolveHosts=&quot;false&quot;/&gt;</pre>
</div></div><p>This will produce a log file for each day, such as logs/localhost_access_log.2008-03-10.log, containing the files requested, IP address of the requester, and similar information.</p><div class="preformatted panel" style="border-width: 1px;"><div class="preformattedContent panelContent">
<pre>128.34.123.121 - - [10/Mar/2008:15:55:57 -0500] &quot;GET /upload/ClickPoints.jsp HTTP/1.1&quot; 200 2725 </pre>
</div></div><p>In addition, Tomcat does not swallow the System.out and System.err JVM output streams. You may use these streams for elementary logging if you wish, but a more robust approach such as commons-logging or <a class="external-link" href="https://logging.apache.org/log4j/2.x/" rel="nofollow">Log4J</a> is recommended for production applications.</p><h3 id="Logging-Q2Whatroledoescommons-loggingplayinlogging?"><span class="confluence-anchor-link" id="Logging-Q2"></span>What role does commons-logging play in logging?</h3><p>Tomcat wants to support multiple logging implementations, so it uses commons-logging. In case that's unclear, think of it like this. You are a Tomcat developer. The car you drive when logging is the commons-logging car. The engine of that car is either JULI or log4j. Without one of these engines, the car goes no where. However regardless of whether you use JULI or log4j, the steering wheel, break, gas pedal, etc. are the same.</p><p>Related FAQ: <a href="#Logging-Q3">What role does JULI and log4j play in logging?</a></p><h3 id="Logging-Q3WhatroledoesJULIandlog4jplayinlogging?"><span class="confluence-anchor-link" id="Logging-Q3"></span>What role does JULI and log4j play in logging?</h3><p>First see: <a href="#Logging-Q2">What role does commons-logging play in logging?</a></p><p>Note in addition that in your own applications you could log directly with JULI or log4j. But once you choose one, you can't easily switch to the other later. If you use commons-logging you can.</p><h3 id="Logging-Q4HowdoIconfigurecommons-loggingforusewithTomcat?"><span class="confluence-anchor-link" id="Logging-Q4"></span>How do I configure commons-logging for use with Tomcat?</h3><p>You need to specify a commons-logging configuration file and, if you wish, a logging implementation that supports commons-logging. JDK 1.4 (and later) java.util.Logging and Log4j are the two most commonly used logging toolkits for Tomcat. Tomcat 5.5 and Tomcat 6.0 use java.logging as default implementation for commons-logging. So this <em>should</em> work by default, but sometimes it doesn't (see <a href="#Logging-Q9">#Q9</a>).</p><p>If you supply an external logging toolkit such as Log4J, it needs to be located in the $CATALINA_HOME/common/lib directory (for Tomcat 5.0 and earlier). Tomcat 5.5 and later uses commons-logging while bootstrapping so some people suggest adding Log4j to the bootstrap classpath by using the scripts in $CATALINA_HOME/bin (see <a class="external-link" href="https://tomcat.markmail.org/message/3sgxfol3njcfutsm" rel="nofollow">Need for it to be in bootstrap classpath?</a>). A better approach apparently working is:</p><ol><li>Put log4j.jar in the $CATALINA_HOME/common/lib directory</li><li>Put the <em>full</em> commons-logging.jar in the $CATALINA_HOME/common/lib directory, even if you see the <em>reduced</em> API version there, named commons-logging-api.jar</li></ol><p>Through some classloading voodoo during bootstrapping, if you have the full commons-logging.jar file in your common/lib directory, it replaces the classes from the commons-logging-api.jar file and will reinitialize the logging system and attempt to locate log4j or whatever other logging system you may be using. (see <a class="external-link" href="https://tomcat.markmail.org/message/3sgxfol3njcfutsm#query:+page:1+mid:7oce37bngiq2otlu+state:results" rel="nofollow">this thread</a>).</p><p>The above recipe is for Tomcat 5.5. For Tomcat 7 — see <a class="external-link" href="https://tomcat.apache.org/tomcat-7.0-doc/logging.html" rel="nofollow">Documentation</a>.</p><p>See also the following mailing list discussions:</p><ul><li><a class="external-link" href="https://marc.info/?l=tomcat-user&amp;m=106623436423859&amp;w=2" rel="nofollow">A log4j 1.x example</a></li><li><a class="external-link" href="https://marc.info/?l=tomcat-user&amp;m=108330970225012&amp;w=2" rel="nofollow">Logging Configuration</a></li><li><a class="external-link" href="https://marc.info/?l=tomcat-user&amp;m=108578233003073&amp;w=2" rel="nofollow">Example with JSVC and running on port 80.</a></li><li><a class="external-link" href="https://minaret.biz/tips/tomcatLogging.html" rel="nofollow">Tomcat and Log4j Configuration (and Velocity), addressing and solving the bootstrap commons-logging.jar problem</a></li></ul><h3 id="Logging-Q5HowshouldIloginmyownwebapps?"><span class="confluence-anchor-link" id="Logging-Q5"></span>How should I log in my own webapps?</h3><p>While you can use System.out and System.err to log, we strongly recommend using a toolkit like Log4J or JDK 1.4's java.util.logging package. With these toolkits, you have significantly more functionality. For example, sending emails, logging to a database, controlling at runtime the logging level of different classes, inspecting the logs with a graphical viewer, etc.</p><p>We also recommend that you separate your logging from Tomcat's internal logging. That means you should bundle your logging toolkit with your webapp. If you are using Log4J, for example, place the Log4J jar in the WEB-INF/lib directory of your webapp and the Log4J configuration file in the WEB-INF/classes directory of your webapp. This way different web applications can have different logging configurations and you don't need to worry about them interfering with each other.</p><h3 id="Logging-Q6WheredoesSystem.outgo?"><span class="confluence-anchor-link" id="Logging-Q6"></span>Where does System.out go?</h3><p>System.out and System.err are both redirected to CATALINA_BASE/logs/catalina.out when using Tomcat's startup scripts (bin/startup.sh/.bat or bin/catalina.sh/.bat). Any code that writes to System.out or System.err will end up writing to that file.</p><p>If your webapp uses System.out and/or System.err a lot, you can suppress this via the 'swallowOutput' attribute in your &lt;Context&gt; configuration element and send to different log files (configured elsewhere: see the documentation for configuring logging).</p><h3 id="Logging-Q10HowdoIrotatecatalina.out?"><span class="confluence-anchor-link" id="Logging-Q10"></span>How do I rotate catalina.out?</h3><p>CATALINA_BASE/logs/catalina.out does not rotate. But it should not be an issue because nothing should be printing to standard output since you are using a logging package, right?</p><p>If you really must rotate catalina.out, here are some techniques you can use:</p><ol><li>If you are using jsvc 1.0.4 or later (from <a class="external-link" href="https://commons.apache.org/proper/commons-daemon/" rel="nofollow">Apache Commons Daemon</a> project) to launch Tomcat, you can send SIGUSR1 signal to jsvc to get it to re-open its log files (<a class="external-link" href="https://issues.apache.org/jira/browse/DAEMON-95" rel="nofollow">Jira Ticket</a>). You can couple this with 'logrotate' or your favorite log-rotation utility (including good-old 'mv') to re-name catalina.out at intervals and then get jsvc to re-open the original (catalina.out) file and continue writing to it.</li><li>Use 'logrotate' with the 'copytruncate' option. This allows you to externally rotate catalina.out without changing anything within Tomcat.</li><li>Modify bin/catalina.sh (or bin/catalina.bat) to pipe output from the JVM into a piped-logger such as <a class="external-link" href="https://linux.die.net/man/1/cronolog" rel="nofollow">cronolog</a> or Apache httpd's <a class="external-link" href="https://httpd.apache.org/docs/2.4/logs.html#piped" rel="nofollow">rotatelogs</a> (note that the previous reference is for Apache httpd documentation and *is not applicable to Tomcat* – it merely illustrates the concept).<br/>See also the patch in <a class="external-link" href="https://bz.apache.org/bugzilla/show_bug.cgi?id=53930" rel="nofollow">Bug 53930, &quot;Allow capture of catalina stdout/stderr to a command instead of just a file&quot;</a>.</li></ol><p>References to mailing list discussions:</p><ul><li><a class="external-link" href="https://marc.info/?t=105544472600001&amp;r=1&amp;w=2a" rel="nofollow">tomcat-users thread from 2003</a></li><li><a class="external-link" href="https://markmail.org/thread/2t6y5lf4dnx4nqpb" rel="nofollow">tomcat-users thread from 2009</a></li><li><a class="external-link" href="https://markmail.org/thread/oif7l27h4nqp3g4e" rel="nofollow">tomcat-users thread from 2011</a></li><li><a class="external-link" href="https://markmail.org/thread/3cjpvgjkpxrqrhlp" rel="nofollow">tomcat-users thread from 2012</a></li></ul><h3 id="Logging-Q7WherearethelogswhenrunningTomcatasaWindowsservice?"><span class="confluence-anchor-link" id="Logging-Q7"></span>Where are the logs when running Tomcat as a Windows service?</h3><p>See these mailing list archive threads:</p><ul><li><a class="external-link" href="https://tomcat.markmail.org/message/3fjakrf77dqmy5nz" rel="nofollow">Where are the Tomcat logs w</a><a class="external-link" href="https://tomcat.markmail.org/message/3fjakrf77dqmy5nz" rel="nofollow">hen running as a Windows service?</a></li></ul><h3 id="Logging-Q8HowdoIcustomizethelocationofthetomcatlogging.propertiesfile?"><span class="confluence-anchor-link" id="Logging-Q8"></span>How do I customize the location of the tomcat logging.properties file?</h3><p>Set the following property when starting tomcat:</p><p>java.util.logging.config.file</p><p>Example: <code>-Djava.util.logging.config.file=/etc/tomcat/logging.properties</code></p><p>For another example of how to set this look in catalina.sh for Tomcat 6.0.16 on lines 182-185. The statements look like this:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: bash; gutter: false; theme: Default" data-theme="Default"># Set juli LogManager if it is present
if [ -r &quot;$CATALINA_BASE&quot;/conf/logging.properties ]; then
  JAVA_OPTS=&quot;$JAVA_OPTS &quot;-Djava.util.logging.manager=org.apache.juli.ClassLoaderLogManager&quot; &quot;-Djava.util.logging.config.file=&quot;$CATALINA_BASE/conf/logging.properties&quot;
fi</pre>
</div></div><p>Projects such as JPackage that repackage Tomcat for Linux typically move the configuration to a directory dictated by the FHS standard (<a class="external-link" href="http://www.pathname.com/fhs/" rel="nofollow">http://www.pathname.com/fhs/</a>), and therefore use the java.util.logging.config.file property to set the location of the logging.properties file in the Tomcat startup script.</p><p>On Fedora the startup script in typically located in /etc/rc.d/init.d/ and on Gentoo linux it is located in /etc/init.d/. On RedHat the startup script for Tomcat 5.5 is /etc/init.d/tomcat5 but eventually the real startup script is /usr/bin/dtomcat5.</p><h3 id="Logging-Q9Sincejava.loggingisthedefaultcommons-loggingimplementationinTomcat,whyisitnotworkinginmyLinuxdistribution?"><span class="confluence-anchor-link" id="Logging-Q9"></span>Since java.logging is the default commons-logging implementation in Tomcat, why is it not working in my Linux distribution?</h3><p>Yes, if you read Tomcat logging documentation, it says java.util.logging should work by default. But many Linux distribution repackage Tomcat and sometimes it does NOT work by default.</p><p>Here are some things you can check:</p><ol><li>tomcat-juli.jar should be in your $CATALINA_HOME/bin directory</li><li>tomcat startup script should run java with <code>-Djava.util.logging.manager=org.apache.juli.ClassLoaderLogManager</code></li><li>tomcat startup script should run java with <code>-Djava.util.logging.config.file=&lt;some_path&gt;/logging.properties</code></li><li>obviously, the logging.properties file must exist in the directory specified in the tomcat script at point #3</li></ol><p>If you don't know where to look for your Tomcat startup script, see the previous <a href="#Logging-Q8">How do I customize the location of the tomcat logging.properties file?</a></p><p>In RHEL5 (RedHat Enterprise Server 5) the Tomcat 5.5 rpm installation does not include the tomcat-juli.jar file. This is what I made:</p><ul><li>look for what Tomcat version you got installed with: <code>yum list installed tomcat5</code></li></ul><p>Since I had the 5.5.23, I downloaded the Tomcat Binaries 5.5.23 from <a class="external-link" href="https://archive.apache.org/dist/tomcat/" rel="nofollow">https://archive.apache.org/dist/tomcat/</a>, then:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Default" data-theme="Default">tar xf apache-tomcat-5.5.23.tar.gz
cd apache-tomcat-5.5.23/bin
cp tomcat-juli.jar /usr/share/tomcat5/bin/</pre>
</div></div><p>Restart Tomcat... and it's working!</p><p><br/></p>
                    </div>

                                        
                 
                </div>             </div> 
            <div id="footer" role="contentinfo">
                <section class="footer-body">
                    <p>Document generated by Confluence on мая 02, 2023 11:01</p>
                    <div id="footer-logo"><a href="https://www.atlassian.com/">Atlassian</a></div>
                </section>
            </div>
        </div>     </body>
</html>
