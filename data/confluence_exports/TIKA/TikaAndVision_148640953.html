<!DOCTYPE html>
<html>
    <head>
        <title>TIKA : TikaAndVision</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        <ol id="breadcrumbs">
                            <li class="first">
                                <span><a href="index.html">TIKA</a></span>
                            </li>
                                                    <li>
                                <span><a href="Home_109454051.html">Home</a></span>
                            </li>
                                                </ol>
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            TIKA : TikaAndVision
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    <div class="page-metadata">
                        
        
    
    
        
    
        
        
            Created by <span class='author'> Chris Mattmann</span>, last modified on мар 07, 2020
                        </div>
                    <div id="main-content" class="wiki-content group">
                    <h1 id="TikaAndVision-TikaandComputerVision">Tika and Computer Vision</h1><p><style type='text/css'>/*<![CDATA[*/
div.rbtoc1683040428903 {padding: 0px;}
div.rbtoc1683040428903 ul {margin-left: 0px;}
div.rbtoc1683040428903 li {margin-left: 0px;padding-left: 0px;}

/*]]>*/</style><div class='toc-macro rbtoc1683040428903'>
<ul class='toc-indentation'>
<li><a href='#TikaAndVision-TikaandComputerVision'>Tika and Computer Vision</a>
<ul class='toc-indentation'>
<li><a href='#TikaAndVision-TikaandTensorflowImageRecognition'>Tika and Tensorflow Image Recognition</a>
<ul class='toc-indentation'>
<li><a href='#TikaAndVision-1.TensorflowUsingCommandlineInvocation'>1. Tensorflow Using Commandline Invocation</a>
<ul class='toc-indentation'>
<li><a href='#TikaAndVision-Step1.Installthedependencies'>Step 1. Install the dependencies</a></li>
<li><a href='#TikaAndVision-Step2.CreateaTika-ConfigXMLtoenableTensorflowparser.'>Step 2. Create a Tika-Config XML to enable Tensorflow parser.</a></li>
<li><a href='#TikaAndVision-Step3:Demo'>Step 3: Demo</a></li>
</ul>
</li>
<li><a href='#TikaAndVision-2.TensorflowUsingRESTServer'>2. Tensorflow Using REST Server</a>
<ul class='toc-indentation'>
<li><a href='#TikaAndVision-Step1.SetupRESTServer'>Step 1. Setup REST Server</a>
<ul class='toc-indentation'>
<li><a href='#TikaAndVision-a.Usingdocker(Recommended)'>a. Using docker (Recommended)</a></li>
<li><a href='#TikaAndVision-b.WithoutUsingdocker'>b. Without Using docker</a></li>
</ul>
</li>
<li><a href='#TikaAndVision-Step2.CreateaTika-ConfigXMLtoenableTensorflowparser..1'>Step 2. Create a Tika-Config XML to enable Tensorflow parser.</a></li>
<li><a href='#TikaAndVision-Step3.Demo'>Step 3. Demo</a></li>
<li><a href='#TikaAndVision-ChangingthedefaulttopN,APIportorURL'>Changing the default topN, API port or URL</a></li>
</ul>
</li>
<li><a href='#TikaAndVision-Questions/Suggestions/Improvements/Feedback?'>Questions / Suggestions / Improvements / Feedback ?</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div></p><p class="line874">This page describes how to make use of Object (Visual) Recognition capability of Apache Tika.<span> </span>TIKA-1993 introduced a new parser to perform object recognition on images.<span> </span>Visit<span> </span><a class="external-link" href="https://issues.apache.org/jira/browse/TIKA-1993" rel="nofollow" style="text-decoration: none;">TIKA-1993 issue on Jira</a><span> </span>or<span> </span><a class="external-link" href="https://github.com/apache/tika/pull/125" rel="nofollow" style="text-decoration: none;">pull request on Github</a><span> </span>to read the related conversation. The model was updated from Inception V3 to Inception V4 with<span> </span><a class="external-link" href="https://issues.apache.org/jira/browse/TIKA-2306" rel="nofollow" style="text-decoration: none;">TIKA-2306</a><span> </span>(<a class="external-link" href="https://github.com/apache/tika/pull/163" rel="nofollow" style="text-decoration: none;">Pull request on Github</a>). Continue reading to get Tika up and running for object recognition.</p><p class="line862">Currently, Tika utilises<span> </span><a class="external-link" href="https://arxiv.org/abs/1602.07261" rel="nofollow" style="text-decoration: none;">Inception-V4</a><span> </span>model from<span> </span><a class="external-link" href="https://www.tensorflow.org/" rel="nofollow" style="text-decoration: none;">Tensorflow</a><span> </span>for recognizing objects in the JPEG images.</p><p class="line867"><br/></p><h2 id="TikaAndVision-TikaandTensorflowImageRecognition">Tika and Tensorflow Image Recognition</h2><p class="line874">Tika has two different ways of bindings to Tensorflow:</p><ol><li>Using Commandline Invocation -- Recommended for quick testing, not for production use</li><li>Using REST API -- Recommended for production use</li></ol><p class="line867"><br/></p><h3 id="TikaAndVision-1.TensorflowUsingCommandlineInvocation">1. Tensorflow Using Commandline Invocation</h3><p class="line867"><strong>Pros of this approach:</strong></p><ul><li style="list-style-type: none;">This parser is easy to setup and test</li></ul><p class="line867"><strong>Cons:</strong></p><ul><li style="list-style-type: none;">Very inefficient/slow as it loads and unloads model for every parse call</li></ul><p class="line867"><br/></p><h4 id="TikaAndVision-Step1.Installthedependencies">Step 1. Install the dependencies</h4><p class="line862">To install tensorflow, follow the instructions on<span> </span><a class="external-link" href="https://www.tensorflow.org/install/" rel="nofollow" style="text-decoration: none;">the official site here</a><span> </span>for your environment.<span> </span>Unless you know what you are doing, you are recommended to follow pip installation.</p><p class="line862">Then clone the repository<span> </span><a class="external-link" href="https://github.com/tensorflow/models" rel="nofollow" style="text-decoration: none;">tensorflow/models</a><span> </span>or download the<span> </span><a class="external-link" href="https://github.com/tensorflow/models/archive/master.zip" rel="nofollow" style="text-decoration: none;">zip file</a>.</p><ul><li style="list-style-type: none;"><p class="line891">git clone <a class="external-link" href="https://github.com/tensorflow/models.git" rel="nofollow">https://github.com/tensorflow/models.git</a></p></li></ul><p class="line874">Add 'models/slim' folder to the environment variable, PYTHONPATH.</p><ul><li style="list-style-type: none;"><p class="line891">$ export PYTHONPATH=&quot;$<a class="external-link" href="http://PYTHONPATH/path/to/models/slim" rel="nofollow">PYTHONPATH:/path/to/models/slim</a>&quot;</p></li></ul><p class="line874">To test the readiness of your environment :</p><ul><li style="list-style-type: none;"><p class="line891">$ python -c 'import tensorflow, numpy, dataset; print(&quot;OK&quot;)'</p></li></ul><p class="line874">If the above command prints the message &quot;OK&quot;, then the requirements are satisfied.</p><p class="line867"><br/></p><h4 id="TikaAndVision-Step2.CreateaTika-ConfigXMLtoenableTensorflowparser.">Step 2. Create a Tika-Config XML to enable Tensorflow parser.</h4><ul><li style="list-style-type: none;"><p class="line862">A sample config can be found in Tika source code at<span> </span><a class="external-link" href="https://raw.githubusercontent.com/apache/tika/master/tika-parsers/src/test/resources/org/apache/tika/parser/recognition/tika-config-tflow.xml" rel="nofollow" style="text-decoration: none;">tika-parsers/src/test/resources/org/apache/tika/parser/recognition/tika-config-tflow.xml</a></p></li></ul><p class="line867"><strong>Here is an example:</strong></p><p><a class="external-link" href="https://163.172.69.106/tika/TikaAndVision" rel="nofollow" style="text-decoration: none;">Toggle line numbers</a></p><pre lang="en"><span class="line"><span class="LineNumber" style="color: gray;"><a class="external-link" href="https://163.172.69.106/tika/TikaAndVision#CA-90590c23d8728c71d2b03c4e03271c8ae7de665e_1" rel="nofollow" style="text-decoration: none;">   1</a> </span><span class="ID" style="color: rgb(0,0,0);">&lt;properties</span><span class="ID" style="color: rgb(0,0,0);">&gt;</span></span>
<span class="line"><span class="LineNumber" style="color: gray;"><a class="external-link" href="https://163.172.69.106/tika/TikaAndVision#CA-90590c23d8728c71d2b03c4e03271c8ae7de665e_2" rel="nofollow" style="text-decoration: none;">   2</a> </span>    <span class="ID" style="color: rgb(0,0,0);">&lt;parsers</span><span class="ID" style="color: rgb(0,0,0);">&gt;</span></span>
<span class="line"><span class="LineNumber" style="color: gray;"><a class="external-link" href="https://163.172.69.106/tika/TikaAndVision#CA-90590c23d8728c71d2b03c4e03271c8ae7de665e_3" rel="nofollow" style="text-decoration: none;">   3</a> </span>        <span class="ID" style="color: rgb(0,0,0);">&lt;parser</span> <span class="ID" style="color: rgb(0,0,0);">class=</span><span class="String" style="color: rgb(0,64,128);">&quot;org.apache.tika.parser.recognition.ObjectRecognitionParser&quot;</span><span class="ID" style="color: rgb(0,0,0);">&gt;</span></span>
<span class="line"><span class="LineNumber" style="color: gray;"><a class="external-link" href="https://163.172.69.106/tika/TikaAndVision#CA-90590c23d8728c71d2b03c4e03271c8ae7de665e_4" rel="nofollow" style="text-decoration: none;">   4</a> </span>            <span class="ID" style="color: rgb(0,0,0);">&lt;mime</span><span class="ID" style="color: rgb(0,0,0);">&gt;</span>image/jpeg<span class="ID" style="color: rgb(0,0,0);">&lt;/mime&gt;</span></span>
<span class="line"><span class="LineNumber" style="color: gray;"><a class="external-link" href="https://163.172.69.106/tika/TikaAndVision#CA-90590c23d8728c71d2b03c4e03271c8ae7de665e_5" rel="nofollow" style="text-decoration: none;">   5</a> </span>            <span class="ID" style="color: rgb(0,0,0);">&lt;params</span><span class="ID" style="color: rgb(0,0,0);">&gt;</span></span>
<span class="line"><span class="LineNumber" style="color: gray;"><a class="external-link" href="https://163.172.69.106/tika/TikaAndVision#CA-90590c23d8728c71d2b03c4e03271c8ae7de665e_6" rel="nofollow" style="text-decoration: none;">   6</a> </span>                <span class="ID" style="color: rgb(0,0,0);">&lt;param</span> <span class="ID" style="color: rgb(0,0,0);">name=</span><span class="String" style="color: rgb(0,64,128);">&quot;topN&quot;</span> <span class="ID" style="color: rgb(0,0,0);">type=</span><span class="String" style="color: rgb(0,64,128);">&quot;int&quot;</span><span class="ID" style="color: rgb(0,0,0);">&gt;</span>2<span class="ID" style="color: rgb(0,0,0);">&lt;/param&gt;</span></span>
<span class="line"><span class="LineNumber" style="color: gray;"><a class="external-link" href="https://163.172.69.106/tika/TikaAndVision#CA-90590c23d8728c71d2b03c4e03271c8ae7de665e_7" rel="nofollow" style="text-decoration: none;">   7</a> </span>                <span class="ID" style="color: rgb(0,0,0);">&lt;param</span> <span class="ID" style="color: rgb(0,0,0);">name=</span><span class="String" style="color: rgb(0,64,128);">&quot;minConfidence&quot;</span> <span class="ID" style="color: rgb(0,0,0);">type=</span><span class="String" style="color: rgb(0,64,128);">&quot;double&quot;</span><span class="ID" style="color: rgb(0,0,0);">&gt;</span>0.015<span class="ID" style="color: rgb(0,0,0);">&lt;/param&gt;</span></span>
<span class="line"><span class="LineNumber" style="color: gray;"><a class="external-link" href="https://163.172.69.106/tika/TikaAndVision#CA-90590c23d8728c71d2b03c4e03271c8ae7de665e_8" rel="nofollow" style="text-decoration: none;">   8</a> </span>                <span class="ID" style="color: rgb(0,0,0);">&lt;param</span> <span class="ID" style="color: rgb(0,0,0);">name=</span><span class="String" style="color: rgb(0,64,128);">&quot;class&quot;</span> <span class="ID" style="color: rgb(0,0,0);">type=</span><span class="String" style="color: rgb(0,64,128);">&quot;string&quot;</span><span class="ID" style="color: rgb(0,0,0);">&gt;</span>org.apache.tika.parser.recognition.tf.TensorflowImageRecParser<span class="ID" style="color: rgb(0,0,0);">&lt;/param&gt;</span></span>
<span class="line"><span class="LineNumber" style="color: gray;"><a class="external-link" href="https://163.172.69.106/tika/TikaAndVision#CA-90590c23d8728c71d2b03c4e03271c8ae7de665e_9" rel="nofollow" style="text-decoration: none;">   9</a> </span>            <span class="ID" style="color: rgb(0,0,0);">&lt;/params&gt;</span></span>
<span class="line"><span class="LineNumber" style="color: gray;"><a class="external-link" href="https://163.172.69.106/tika/TikaAndVision#CA-90590c23d8728c71d2b03c4e03271c8ae7de665e_10" rel="nofollow" style="text-decoration: none;">  10</a> </span>        <span class="ID" style="color: rgb(0,0,0);">&lt;/parser&gt;</span></span>
<span class="line"><span class="LineNumber" style="color: gray;"><a class="external-link" href="https://163.172.69.106/tika/TikaAndVision#CA-90590c23d8728c71d2b03c4e03271c8ae7de665e_11" rel="nofollow" style="text-decoration: none;">  11</a> </span>    <span class="ID" style="color: rgb(0,0,0);">&lt;/parsers&gt;</span></span>
<span class="line"><span class="LineNumber" style="color: gray;"><a class="external-link" href="https://163.172.69.106/tika/TikaAndVision#CA-90590c23d8728c71d2b03c4e03271c8ae7de665e_12" rel="nofollow" style="text-decoration: none;">  12</a> </span><span class="ID" style="color: rgb(0,0,0);">&lt;/properties&gt;</span></span>
</pre><p class="line867"><strong>Description of parameters :</strong></p><p><br/></p><div class="table-wrap"><table class="wrapped confluenceTable"><tbody><tr><td class="confluenceTd"><strong>Param Name</strong></td><td class="confluenceTd"><strong>Type</strong></td><td class="confluenceTd"><strong>Meaning</strong></td><td class="confluenceTd"><strong>Range</strong></td><td class="confluenceTd"><strong>Example</strong></td></tr><tr><td class="confluenceTd">topN</td><td class="confluenceTd">int</td><td class="confluenceTd">Number of object names to output</td><td class="confluenceTd">a non-zero positive integer</td><td class="confluenceTd">1 to receive top 1 object name</td></tr><tr><td class="confluenceTd">minConfidence</td><td class="confluenceTd">double</td><td class="confluenceTd">Minimum confidence required to output the name of detected objects</td><td class="confluenceTd">[0.0 to 1.0] inclusive</td><td class="confluenceTd">0.9 for outputting object names iff at least 90% confident</td></tr><tr><td class="confluenceTd">class</td><td class="confluenceTd">string</td><td class="confluenceTd">Class that implements object recognition functionality</td><td class="confluenceTd">constant string</td><td class="confluenceTd"><a class="external-link" href="http://org.apache.tika.parser.recognition.tf" rel="nofollow">org.apache.tika.parser.recognition.tf</a>.TensorflowImageRecParser</td></tr></tbody></table></div><p class="line867"><br/></p><h4 id="TikaAndVision-Step3:Demo">Step 3: Demo</h4><p class="line874">To use the vision capability via Tensorflow, just supply the above configuration to Tika.</p><p class="line862">For example, to use in Tika App (Assuming you have<span> </span><em>tika-app</em><span> </span>JAR and it is ready to run):</p><p class="line867"><br/></p><pre>      $ java -jar tika-app/target/tika-app-1.15-SNAPSHOT.jar \
         --config=tika-parsers/src/test/resources/org/apache/tika/parser/recognition/tika-config-tflow.xml \
         https://upload.wikimedia.org/wikipedia/commons/f/f6/Working_Dogs%2C_Handlers_Share_Special_Bond_DVIDS124942.jpg</pre><p class="line874">The input image is:</p><p class="line867"><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image external_image confluence-external-resource" draggable="false" alt="Germal Shepherd with Military" src="https://upload.wikimedia.org/wikipedia/commons/f/f6/Working_Dogs,_Handlers_Share_Special_Bond_DVIDS124942.jpg" data-image-src="https://upload.wikimedia.org/wikipedia/commons/f/f6/Working_Dogs,_Handlers_Share_Special_Bond_DVIDS124942.jpg"></span></p><p class="line874">And, the top 2 detections are:</p><p><a class="external-link" href="https://163.172.69.106/tika/TikaAndVision" rel="nofollow" style="text-decoration: none;">Toggle line numbers</a></p><pre lang="en"><span class="line"><span class="LineNumber" style="color: gray;"><a class="external-link" href="https://163.172.69.106/tika/TikaAndVision#CA-99dd82d09723d6e894dfcc0442b8e4ebe7923f69_1" rel="nofollow" style="text-decoration: none;">   1</a> </span>...</span>
<span class="line"><span class="LineNumber" style="color: gray;"><a class="external-link" href="https://163.172.69.106/tika/TikaAndVision#CA-99dd82d09723d6e894dfcc0442b8e4ebe7923f69_2" rel="nofollow" style="text-decoration: none;">   2</a> </span><span class="ID" style="color: rgb(0,0,0);">&lt;meta</span> <span class="ID" style="color: rgb(0,0,0);">name=</span><span class="String" style="color: rgb(0,64,128);">&quot;OBJECT&quot;</span> <span class="ID" style="color: rgb(0,0,0);">content=</span><span class="String" style="color: rgb(0,64,128);">&quot;German shepherd, German shepherd dog, German police dog, alsatian (0.78435)&quot;</span><span class="ID" style="color: rgb(0,0,0);">/&gt;</span></span>
<span class="line"><span class="LineNumber" style="color: gray;"><a class="external-link" href="https://163.172.69.106/tika/TikaAndVision#CA-99dd82d09723d6e894dfcc0442b8e4ebe7923f69_3" rel="nofollow" style="text-decoration: none;">   3</a> </span><span class="ID" style="color: rgb(0,0,0);">&lt;meta</span> <span class="ID" style="color: rgb(0,0,0);">name=</span><span class="String" style="color: rgb(0,64,128);">&quot;OBJECT&quot;</span> <span class="ID" style="color: rgb(0,0,0);">content=</span><span class="String" style="color: rgb(0,64,128);">&quot;military uniform (0.06694)&quot;</span><span class="ID" style="color: rgb(0,0,0);">/&gt;</span></span>
<span class="line"><span class="LineNumber" style="color: gray;"><a class="external-link" href="https://163.172.69.106/tika/TikaAndVision#CA-99dd82d09723d6e894dfcc0442b8e4ebe7923f69_4" rel="nofollow" style="text-decoration: none;">   4</a> </span>...</span>
</pre><p class="line867"><br/></p><h3 id="TikaAndVision-2.TensorflowUsingRESTServer">2. Tensorflow Using REST Server</h3><p class="line874">This is the recommended way for utilizing visual recognition capability of Tika.<span> </span>This approach uses Tensorflow over REST API.<span> </span>To get this working, we are going to start a python flask based REST API server and tell tika to connect to it.<span> </span>All these dependencies and setup complexities are isolated in docker image.</p><p class="line874">Requirements :</p><ul><li style="list-style-type: none;"><p class="line862">Docker -- Visit<span> </span><a class="external-link" href="https://www.docker.com/" rel="nofollow" style="text-decoration: none;">Docker.com</a><span> </span>and install latest version of Docker. (Note: tested on docker v17.03.1)</p></li></ul><p class="line867"><br/></p><h4 id="TikaAndVision-Step1.SetupRESTServer">Step 1. Setup REST Server</h4><p class="line874">You can either start the REST server in an isolated docker container or natively on the host that runs tensorflow.</p><p class="line867"><br/></p><h5 id="TikaAndVision-a.Usingdocker(Recommended)">a. Using docker (Recommended)</h5><p class="line867"><br/></p><p><a class="external-link" href="https://163.172.69.106/tika/TikaAndVision" rel="nofollow" style="text-decoration: none;">Toggle line numbers</a></p><pre lang="en"><span class="line"><span class="LineNumber" style="color: gray;"><a class="external-link" href="https://163.172.69.106/tika/TikaAndVision#CA-40cb7187dabd6e3e859954e9b5564bfc7a056d5a_1" rel="nofollow" style="text-decoration: none;">   1</a> </span>git clone https://github.com/USCDataScience/tika-dockers.git &amp;&amp; <span class="ResWord" style="color: rgb(160,0,0);">cd</span> tika-dockers</span>
<span class="line"><span class="LineNumber" style="color: gray;"><a class="external-link" href="https://163.172.69.106/tika/TikaAndVision#CA-40cb7187dabd6e3e859954e9b5564bfc7a056d5a_2" rel="nofollow" style="text-decoration: none;">   2</a> </span>docker build -f InceptionRestDockerfile -t uscdatascience/inception-rest-tika .</span>
<span class="line"><span class="LineNumber" style="color: gray;"><a class="external-link" href="https://163.172.69.106/tika/TikaAndVision#CA-40cb7187dabd6e3e859954e9b5564bfc7a056d5a_3" rel="nofollow" style="text-decoration: none;">   3</a> </span>docker run -p 8764:8764 -it uscdatascience/inception-rest-tika</span>
</pre><p class="line862">Once it is done, test the setup by visiting<span> </span><a class="external-link" href="http://localhost:8764/inception/v4/classify/image?topn=2&amp;min_confidence=0.03&amp;url=https://upload.wikimedia.org/wikipedia/commons/f/f6/Working_Dogs%2C_Handlers_Share_Special_Bond_DVIDS124942.jpg" rel="nofollow" style="text-decoration: none;">http://localhost:8764/inception/v4/classify/image?topn=2&amp;min_confidence=0.03&amp;url=https://upload.wikimedia.org/wikipedia/commons/f/f6/Working_Dogs%2C_Handlers_Share_Special_Bond_DVIDS124942.jpg</a><span> </span>in your web browser.</p><p class="line867"><strong>Sample output from API:</strong></p><pre>{
   &quot;confidence&quot;:[
      0.7843596339225769,
      0.06694009155035019
   ],
   &quot;classnames&quot;:[
      &quot;German shepherd, German shepherd dog, German police dog, alsatian&quot;,
      &quot;military uniform&quot;
   ],
   &quot;classids&quot;:[
      236,
      653
   ],
   &quot;time&quot;:{
      &quot;read&quot;:7403,
      &quot;units&quot;:&quot;ms&quot;,
      &quot;classification&quot;:470
   }
}</pre><p class="line874">Note: MAC USERS:</p><ul><li style="list-style-type: none;">If you are using an older version, say, 'Docker toolbox' instead of the newer 'Docker for Mac',</li></ul><p class="line874">you need to add port forwarding rules in your Virtual Box default machine.</p><ol><li>Open the Virtual Box Manager.</li><li>Select your Docker Machine Virtual Box image.</li><li><p class="line862">Open Settings -&gt; Network -&gt; Advanced -&gt; Port Forwarding.</p></li><li>Add an appname,Host IP 127.0.0.1 and set both ports to 8764.</li></ol><p class="line867"><br/></p><h5 id="TikaAndVision-b.WithoutUsingdocker">b. Without Using docker</h5><p class="line862">If you chose to setup REST server without a docker container, you are free to manually install all the required tools specified in the<span> </span><a class="external-link" href="https://github.com/USCDataScience/tika-dockers/blob/master/InceptionRestDockerfile" rel="nofollow" style="text-decoration: none;">docker file</a>.</p><p class="line874">Note: docker file has setup instructions for Ubuntu, you will have to transform those commands for your environment.</p><p class="line867"><br/></p><p><a class="external-link" href="https://163.172.69.106/tika/TikaAndVision" rel="nofollow" style="text-decoration: none;">Toggle line numbers</a></p><pre lang="en"><span class="line"><span class="LineNumber" style="color: gray;"><a class="external-link" href="https://163.172.69.106/tika/TikaAndVision#CA-62c32dd115bb382f29b78cd803b155699b22697e_1" rel="nofollow" style="text-decoration: none;">   1</a> </span>   python tika-parsers/src/main/resources/org/apache/tika/parser/recognition/tf/inceptionapi.py  --port 8764</span>
</pre><p class="line867"><br/></p><h4 id="TikaAndVision-Step2.CreateaTika-ConfigXMLtoenableTensorflowparser..1">Step 2. Create a Tika-Config XML to enable Tensorflow parser.</h4><ul><li style="list-style-type: none;"><p class="line862">A sample config can be found in Tika source code at<span> </span><a class="external-link" href="https://github.com/apache/tika/blob/da82df5e9def9698fd32f85fe706660641d7c31f/tika-parsers/src/test/resources/org/apache/tika/parser/recognition/tika-config-tflow-rest.xml" rel="nofollow" style="text-decoration: none;">tika-parsers/src/test/resources/org/apache/tika/parser/recognition/tika-config-tflow-rest.xml</a></p></li></ul><p class="line867"><strong>Here is an example:</strong></p><pre>&lt;properties&gt;
    &lt;parsers&gt;
        &lt;parser class=&quot;org.apache.tika.parser.recognition.ObjectRecognitionParser&quot;&gt;
            &lt;mime&gt;image/jpeg&lt;/mime&gt;
            &lt;params&gt;
                &lt;param name=&quot;topN&quot; type=&quot;int&quot;&gt;2&lt;/param&gt;
                &lt;param name=&quot;minConfidence&quot; type=&quot;double&quot;&gt;0.015&lt;/param&gt;
                &lt;param name=&quot;class&quot; type=&quot;string&quot;&gt;org.apache.tika.parser.recognition.tf.TensorflowRESTRecogniser&lt;/param&gt;
            &lt;/params&gt;
        &lt;/parser&gt;
    &lt;/parsers&gt;
&lt;/properties&gt;</pre><p class="line867"><strong>Description of parameters :</strong></p><p><br/></p><div class="table-wrap"><table class="wrapped confluenceTable"><tbody><tr><td class="confluenceTd"><strong>Param Name</strong></td><td class="confluenceTd"><strong>Type</strong></td><td class="confluenceTd"><strong>Meaning</strong></td><td class="confluenceTd"><strong>Range</strong></td><td class="confluenceTd"><strong>Example</strong></td></tr><tr><td class="confluenceTd">topN</td><td class="confluenceTd">int</td><td class="confluenceTd">Number of object names to output</td><td class="confluenceTd">a non-zero positive integer</td><td class="confluenceTd">1 to receive top 1 object name</td></tr><tr><td class="confluenceTd">minConfidence</td><td class="confluenceTd">double</td><td class="confluenceTd">Minimum confidence required to output the name of detected objects</td><td class="confluenceTd">[0.0 to 1.0] inclusive</td><td class="confluenceTd">0.9 for outputting object names iff at least 90% confident</td></tr><tr><td class="confluenceTd">class</td><td class="confluenceTd">string</td><td class="confluenceTd">Name of class that Implements Object recognition Contract</td><td class="confluenceTd">constant string</td><td class="confluenceTd"><a class="external-link" href="http://org.apache.tika.parser.recognition.tf" rel="nofollow">org.apache.tika.parser.recognition.tf</a>.TensorflowRESTRecogniser</td></tr><tr><td class="confluenceTd">healthUri</td><td class="confluenceTd">uri</td><td class="confluenceTd">HTTP URL to check availability of API service</td><td class="confluenceTd">any HTTP URL that gets 200 status code when available</td><td class="confluenceTd"><a class="external-link" href="http://localhost:8764/inception/v4/ping" rel="nofollow">http://localhost:8764/inception/v4/ping</a></td></tr><tr><td class="confluenceTd">apiUri</td><td class="confluenceTd">uri</td><td class="confluenceTd">HTTP URL to POST image data</td><td class="confluenceTd">any HTTP URL that returns data in the JSON format as shown in the sample API output</td><td class="confluenceTd"><a class="external-link" href="http://localhost:8764/inception/v4/classify/image?topk=10" rel="nofollow">http://localhost:8764/inception/v4/classify/image?topk=10</a></td></tr></tbody></table></div><p class="line867"><br/></p><h4 id="TikaAndVision-Step3.Demo">Step 3. Demo</h4><p class="line874">This demo is same as the Commandline Invocation approach, but this is faster and efficient</p><p class="line867"><br/></p><pre>   $ java -jar tika-app/target/tika-app-1.15-SNAPSHOT.jar \
    --config=tika-parsers/src/test/resources/org/apache/tika/parser/recognition/tika-config-tflow-rest.xml \
    https://upload.wikimedia.org/wikipedia/commons/f/f6/Working_Dogs%2C_Handlers_Share_Special_Bond_DVIDS124942.jpg</pre><p class="line874">The input image is:</p><p class="line867"><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image external_image confluence-external-resource" draggable="false" alt="Germal Shepherd with Military" src="https://upload.wikimedia.org/wikipedia/commons/f/f6/Working_Dogs,_Handlers_Share_Special_Bond_DVIDS124942.jpg" data-image-src="https://upload.wikimedia.org/wikipedia/commons/f/f6/Working_Dogs,_Handlers_Share_Special_Bond_DVIDS124942.jpg"></span></p><p class="line874">And, the top 2 detections are:</p><p><a class="external-link" href="https://163.172.69.106/tika/TikaAndVision" rel="nofollow" style="text-decoration: none;">Toggle line numbers</a></p><pre lang="en"><span class="line"><span class="LineNumber" style="color: gray;"><a class="external-link" href="https://163.172.69.106/tika/TikaAndVision#CA-99dd82d09723d6e894dfcc0442b8e4ebe7923f69-1_1" rel="nofollow" style="text-decoration: none;">   1</a> </span>...</span>
<span class="line"><span class="LineNumber" style="color: gray;"><a class="external-link" href="https://163.172.69.106/tika/TikaAndVision#CA-99dd82d09723d6e894dfcc0442b8e4ebe7923f69-1_2" rel="nofollow" style="text-decoration: none;">   2</a> </span><span class="ID" style="color: rgb(0,0,0);">&lt;meta</span> <span class="ID" style="color: rgb(0,0,0);">name=</span><span class="String" style="color: rgb(0,64,128);">&quot;OBJECT&quot;</span> <span class="ID" style="color: rgb(0,0,0);">content=</span><span class="String" style="color: rgb(0,64,128);">&quot;German shepherd, German shepherd dog, German police dog, alsatian (0.78435)&quot;</span><span class="ID" style="color: rgb(0,0,0);">/&gt;</span></span>
<span class="line"><span class="LineNumber" style="color: gray;"><a class="external-link" href="https://163.172.69.106/tika/TikaAndVision#CA-99dd82d09723d6e894dfcc0442b8e4ebe7923f69-1_3" rel="nofollow" style="text-decoration: none;">   3</a> </span><span class="ID" style="color: rgb(0,0,0);">&lt;meta</span> <span class="ID" style="color: rgb(0,0,0);">name=</span><span class="String" style="color: rgb(0,64,128);">&quot;OBJECT&quot;</span> <span class="ID" style="color: rgb(0,0,0);">content=</span><span class="String" style="color: rgb(0,64,128);">&quot;military uniform (0.06694)&quot;</span><span class="ID" style="color: rgb(0,0,0);">/&gt;</span></span>
<span class="line"><span class="LineNumber" style="color: gray;"><a class="external-link" href="https://163.172.69.106/tika/TikaAndVision#CA-99dd82d09723d6e894dfcc0442b8e4ebe7923f69-1_4" rel="nofollow" style="text-decoration: none;">   4</a> </span>...</span>
</pre><p class="line867"><br/></p><h4 id="TikaAndVision-ChangingthedefaulttopN,APIportorURL">Changing the default topN, API port or URL</h4><p class="line874">To change the defaults, update the parameters in config XML file accordingly</p><p class="line867"><strong>Here is an example scenario:</strong></p><p class="line874">Run REST API on port 3030, and get top 4 object names if the confidence is above 10%. You may also change host to something else than 'localhost' if required.</p><p class="line867"><strong>Example Config File</strong></p><pre>&lt;properties&gt;
    &lt;parsers&gt;
        &lt;parser class=&quot;org.apache.tika.parser.recognition.ObjectRecognitionParser&quot;&gt;
            &lt;mime&gt;image/jpeg&lt;/mime&gt;
            &lt;params&gt;
                &lt;param name=&quot;topN&quot; type=&quot;int&quot;&gt;4&lt;/param&gt;
                &lt;param name=&quot;minConfidence&quot; type=&quot;double&quot;&gt;0.1&lt;/param&gt;
                &lt;param name=&quot;class&quot; type=&quot;string&quot;&gt;org.apache.tika.parser.recognition.tf.TensorflowRESTRecogniser&lt;/param&gt;
                &lt;param name=&quot;healthUri&quot; type=&quot;uri&quot;&gt;http://localhost:3030/inception/v4/ping&lt;/param&gt;
                &lt;param name=&quot;apiUri&quot; type=&quot;uri&quot;&gt;http://localhost:3030/inception/v4/classify/image?topk=4&lt;/param&gt;
            &lt;/params&gt;
        &lt;/parser&gt;
    &lt;/parsers&gt;
&lt;/properties&gt;</pre><p class="line867"><strong>To Start the service on port 3030:</strong></p><p class="line874">Using Docker:</p><ul><li style="list-style-type: none;"><p class="line891">docker run -it -p 3030:8764 uscdatascience/inception-rest-tika</p></li></ul><p class="line874">Without Using Docker:</p><p class="line867">python tika-parsers/src/main/resources/org/apache/tika/parser/recognition/tf/inceptionapi.py  --port 3030</p><p class="line867"><br/></p><hr/><p class="line874"><br/></p><p class="line867"><br/></p><h3 id="TikaAndVision-Questions/Suggestions/Improvements/Feedback?">Questions / Suggestions / Improvements / Feedback ?</h3><ol><li><p class="line862">If it was useful, let us know on twitter by mentioning<span> </span><a class="external-link" href="https://twitter.com/ApacheTika" rel="nofollow" style="text-decoration: none;">@ApacheTika</a></p></li><li><p class="line862">If you have questions, let us know by<span> </span><a class="external-link" href="https://tika.apache.org/mail-lists.html" rel="nofollow" style="text-decoration: none;">using Mailing Lists</a></p></li><li><p class="line862">If you find any bugs,<span> </span><a class="external-link" href="https://issues.apache.org/jira/browse/TIKA/" rel="nofollow" style="text-decoration: none;">use Jira to report them</a></p></li></ol>
                    </div>

                                        
                 
                </div>             </div> 
            <div id="footer" role="contentinfo">
                <section class="footer-body">
                    <p>Document generated by Confluence on мая 02, 2023 15:13</p>
                    <div id="footer-logo"><a href="https://www.atlassian.com/">Atlassian</a></div>
                </section>
            </div>
        </div>     </body>
</html>
