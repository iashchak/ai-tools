<!DOCTYPE html>
<html>
    <head>
        <title>TIKA : TikaEvalDatasetteExamples</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        <ol id="breadcrumbs">
                            <li class="first">
                                <span><a href="index.html">TIKA</a></span>
                            </li>
                                                    <li>
                                <span><a href="TikaEval_109454084.html">TikaEval</a></span>
                            </li>
                                                </ol>
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            TIKA : TikaEvalDatasetteExamples
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    <div class="page-metadata">
                        
        
    
    
        
    
        
        
            Created by <span class='author'> Tim Allison</span>, last modified on ноя 13, 2020
                        </div>
                    <div id="main-content" class="wiki-content group">
                    <p>The tika-eval module was initially designed to run locally with an in-memory H2 database.  For collaboration, we've run tika-eval on ~4 million files we've made available on our <a class="external-link" href="https://corpora.tika.apache.org/base/docs/" rel="nofollow">regression virtual machine</a>.  We're publishing this data via <a class="external-link" href="https://github.com/simonw/datasette" rel="nofollow">datasette</a> which runs on top of a sqlite database of tika-eval data.</p><p>We'll make two types of data available: 1) file profiles (file type, sha256, byte size) and 2) extract profiles (profiles of the text extracted by Tika).</p><p>As a first step, we're making available the file profiles.  See below for some useful SQL to run against this dataset: <a class="external-link" href="https://corpora.tika.apache.org/datasette" rel="nofollow">https://corpora.tika.apache.org/datasette</a>.</p><h1 id="TikaEvalDatasetteExamples-FileProfile">File Profile</h1><p><strong>NOTE</strong></p><p>As of Nov 2020, there's a bug in datasette that prevents some of the links from working – the links do not include the base_url.  One way to work around this for now is to add /datasette/ into the url.  For example, if you click on 'json', you'll be directed to: <a class="external-link" href="https://corpora.tika.apache.org/file_profiles.json?sql=select%0D%0A++FILE_PATH%2C%0D%0A++FILE_NAME%2C%0D%0A++fp.FILE_EXTENSION%2C%0D%0A++LENGTH%2C%0D%0A++SHA256%2C%0D%0A++tm.mime_string%2C%0D%0A++tf.mime_string%0D%0Afrom%0D%0A++file_profiles+fp%0D%0A++join+file_mimes+tm+on+tm.mime_id%3Dfp.tika_mime_id%0D%0A++join+file_mimes+tf+on+tf.mime_id%3Dfp.file_mime_id%0D%0Aorder+by%0D%0A++length+desc%0D%0Alimit%0D%0A++101" rel="nofollow">https://corpora.tika.apache.org/file_profiles.json?sql=select...</a>  If you insert /datasette/ like so: <a class="external-link" href="https://corpora.tika.apache.org/file_profiles.json?sql=select%0D%0A++FILE_PATH%2C%0D%0A++FILE_NAME%2C%0D%0A++fp.FILE_EXTENSION%2C%0D%0A++LENGTH%2C%0D%0A++SHA256%2C%0D%0A++tm.mime_string%2C%0D%0A++tf.mime_string%0D%0Afrom%0D%0A++file_profiles+fp%0D%0A++join+file_mimes+tm+on+tm.mime_id%3Dfp.tika_mime_id%0D%0A++join+file_mimes+tf+on+tf.mime_id%3Dfp.file_mime_id%0D%0Aorder+by%0D%0A++length+desc%0D%0Alimit%0D%0A++101" rel="nofollow">https://corpora.tika.apache.org/datasette/file_profiles.json?sql=select...</a><span>, the link works.</span></p><p>As mentioned above, &quot;File Profile&quot; includes the path of the file, the file name, the file extension, the sha256, the length (in bytes) and the file type as identified by Apache Tika and by the linux `file` command.  &quot;File Profile&quot; does not include any of the more interesting data that we can get once we parse the files and then run Extract Profile.</p><p>In this first run of File Profile (November 12, 2020), we did not include &quot;container detection&quot; in Apache Tika's detector.  This means that where file might identify a 'doc', 'ppt' or 'xls' file, Tika will identify 'application/x-tika-msoffice'.  We look forward to repopulating the file_profiles table with Tika's container detection.</p><p>The following sql relies on some SQLite specific syntax.  Your mileage will vary if you use H2 or another database.</p><p>We used 'file version 5.38' and 'Tika 1.24.1'.</p><h2 id="TikaEvalDatasetteExamples-Fulldata:"><span>Full data:</span></h2><pre>select FILE_PATH, FILE_NAME, fp.FILE_EXTENSION,<br/>  LENGTH, SHA256, tm.mime_string, tf.mime_string<br/>from file_profiles fp<br/>  join file_mimes tm on tm.mime_id=fp.tika_mime_id<br/>  join file_mimes tf on tf.mime_id=fp.file_mime_id<br/>order by length desc<br/>limit 100</pre><h2 id="TikaEvalDatasetteExamples-TotalFiles(4,263,744)">Total Files (4,263,744)</h2><pre>select count(1) from file_profiles</pre><h2 id="TikaEvalDatasetteExamples-TotalDistinctFiles(3,726,422)">Total Distinct Files (3,726,422)</h2><pre>select count(1) from (select distinct(sha256) from file_profiles)</pre><h2 id="TikaEvalDatasetteExamples-Top100mimetypesasidentifiedbyTika:">Top 100 mime types as identified by Tika:</h2><pre>select tm.mime_string, count(1) as cnt<br/>from file_profiles fp<br/>  join file_mimes tm on tm.mime_id=fp.tika_mime_id<br/>group by tm.mime_string<br/>order by cnt desc<br/>limit 100</pre><h2 id="TikaEvalDatasetteExamples-Countsof100mostcommonSHA256s">Counts of 100 most common SHA256s</h2><pre>select SHA256, count(1) as cnt<br/>from file_profiles fp<br/>group by SHA256<br/>order by cnt desc<br/>limit 100</pre><h2 id="TikaEvalDatasetteExamples-Listfilesassociatedwiththe100mostcommonSHA256s">List files associated with the 100 most common SHA256s</h2><pre>select shas.sha256, cnt, fp.file_path from<br/>  (select<br/>    fp.SHA256 as sha256, count(1) as cnt<br/>    from file_profiles fp<br/>    group by fp.sha256<br/>    order by count(1) desc<br/>    limit 100<br/>  ) as shas<br/>join file_profiles fp on shas.sha256=fp.sha256<br/>order by shas.cnt desc, shas.sha256, file_path</pre><h2 id="TikaEvalDatasetteExamples-Getthefilepathsfor100PDFs">Get the file paths for 100 PDFs</h2><pre>select FILE_PATH <br/>from file_profiles fp<br/>  join file_mimes m on m.mime_id=fp.tika_mime_id<br/>  where m.mime_string like '%pdf'<br/>limit 100</pre><h2 id="TikaEvalDatasetteExamples-GettheURLsfor100PDFs">Get the URLs for 100 PDFs</h2><pre>select<br/>'<a class="external-link" href="https://corpora.tika.apache.org/base/docs/" rel="nofollow">https://corpora.tika.apache.org/base/docs/'||FILE_PATH</a> as URL<br/>from file_profiles fp<br/>  join file_mimes m on m.mime_id=fp.tika_mime_id<br/>where m.mime_string like '%pdf'<br/>limit 100</pre><h2 id="TikaEvalDatasetteExamples-Iwantallfiles,butIdon&#39;twantafileifitsSHA256isalreadyinthelist">I want all files, but I don't want a file if its SHA256 is already in the list</h2><pre>select first_value(file_path) over ( partition by sha256 order by file_path) as path<br/>from file_profiles fp<br/>group by sha256<br/>order by file_path</pre><h2 id="TikaEvalDatasetteExamples-IwantallPDFs,butIdon&#39;twantafileifitsSHA256isalreadyinthelist">I want all PDFs, but I don't want a file if its SHA256 is already in the list</h2><pre>select first_value(file_path) over ( partition by sha256 order by file_path) as path<br/>from file_profiles p<br/>join file_mimes m on p.tika_mime_id=mime_id<br/>where mime_string like '%pdf'<br/>group by sha256<br/>order by file_path</pre><h2 id="TikaEvalDatasetteExamples-MostcommondifferencesbetweenTikaandFilemimeidentification">Most common differences between Tika and File mime identification</h2><pre>select tm.mime_string as 'tika_mime', fm.mime_string as 'file_mime', count(1) as cnt<br/>from file_profiles fp<br/>  join file_mimes tm on fp.tika_mime_id=tm.mime_id<br/>  join file_mimes fm on fp.file_mime_id=fm.mime_id<br/>where tm.mime_string &lt;&gt; fm.mime_string<br/>group by tm.mime_string, fm.mime_string<br/>order by cnt desc</pre><h2 id="TikaEvalDatasetteExamples-Mostcommonfiletypesthat&#39;file&#39;identifiesbutTikadoesn&#39;t">Most common file types that 'file' identifies but Tika doesn't</h2><pre>select<br/>  fm.mime_string as 'file_mime', count(1) as cnt<br/>from<br/>  file_profiles fp<br/>  join file_mimes tm on fp.tika_mime_id = tm.mime_id<br/>  join file_mimes fm on fp.file_mime_id = fm.mime_id<br/>where<br/>  tm.mime_string &lt;&gt; fm.mime_string<br/>  and (<br/>    tm.mime_string is null<br/>    or length(tm.mime_string) == 0<br/>    or tm.mime_string = 'application/octet-stream'<br/>  )<br/>group by m.mime_string<br/>order by cnt desc</pre><h2 id="TikaEvalDatasetteExamples-MostcommonfiletypesthatTikaidentifiesbut&#39;file&#39;doesn&#39;t">Most common file types that Tika identifies but 'file' doesn't</h2><pre>select tm.mime_string as 'file_mime', count(1) as cnt<br/>from<br/>  file_profiles fp<br/>  join file_mimes tm on fp.tika_mime_id = tm.mime_id<br/>  join file_mimes fm on fp.file_mime_id = fm.mime_id<br/>where<br/>  tm.mime_string &lt;&gt; fm.mime_string<br/>  and (<br/>    fm.mime_string is null<br/>    or length(fm.mime_string) == 0<br/>    or fm.mime_string = 'application/octet-stream'<br/>  )<br/>group by<br/>tm.mime_string<br/>order by cnt desc</pre>
                    </div>

                                        
                 
                </div>             </div> 
            <div id="footer" role="contentinfo">
                <section class="footer-body">
                    <p>Document generated by Confluence on мая 02, 2023 15:13</p>
                    <div id="footer-logo"><a href="https://www.atlassian.com/">Atlassian</a></div>
                </section>
            </div>
        </div>     </body>
</html>
