<!DOCTYPE html>
<html>
    <head>
        <title>TIKA : TikaAndVisionVideo</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        <ol id="breadcrumbs">
                            <li class="first">
                                <span><a href="index.html">TIKA</a></span>
                            </li>
                                                    <li>
                                <span><a href="Home_109454051.html">Home</a></span>
                            </li>
                                                </ol>
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            TIKA : TikaAndVisionVideo
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    <div class="page-metadata">
                        
        
    
    
        
    
        
        
            Created by <span class='author'> Chris Mattmann</span> on мар 07, 2020
                        </div>
                    <div id="main-content" class="wiki-content group">
                    <p><style type='text/css'>/*<![CDATA[*/
div.rbtoc1683040429424 {padding: 0px;}
div.rbtoc1683040429424 ul {margin-left: 0px;}
div.rbtoc1683040429424 li {margin-left: 0px;padding-left: 0px;}

/*]]>*/</style><div class='toc-macro rbtoc1683040429424'>
<ul class='toc-indentation'>
<li><a href='#TikaAndVisionVideo-TikaandComputerVisionforVideos'>Tika and Computer Vision for Videos</a>
<ul class='toc-indentation'>
<li><a href='#TikaAndVisionVideo-TikaandTensorflowVideoRecognition'>Tika and Tensorflow Video Recognition</a>
<ul class='toc-indentation'>
<li><a href='#TikaAndVisionVideo-1.TensorflowUsingRESTServer'>1. Tensorflow Using REST Server</a>
<ul class='toc-indentation'>
<li><a href='#TikaAndVisionVideo-Step1.SetupRESTServer'>Step 1. Setup REST Server</a>
<ul class='toc-indentation'>
<li><a href='#TikaAndVisionVideo-a.Usingdocker(Recommended)'>a. Using docker (Recommended)</a></li>
<li><a href='#TikaAndVisionVideo-b.WithoutUsingdocker'>b. Without Using docker</a></li>
</ul>
</li>
<li><a href='#TikaAndVisionVideo-Step2.CreateaTika-ConfigXMLtoenableTensorflowVideoparser.'>Step 2. Create a Tika-Config XML to enable Tensorflow Video parser.</a></li>
<li><a href='#TikaAndVisionVideo-Step3:Demo'>Step 3: Demo</a></li>
<li><a href='#TikaAndVisionVideo-ChangingthedefaulttopN,APIportorURL'>Changing the default topN, API port or URL</a></li>
</ul>
</li>
<li><a href='#TikaAndVisionVideo-ManualInstallationguide'>Manual Installation guide</a>
<ul class='toc-indentation'>
<li><a href='#TikaAndVisionVideo-InstallingTensorflow'>Installing Tensorflow</a></li>
<li><a href='#TikaAndVisionVideo-InstallingOpenCV'>Installing OpenCV</a></li>
</ul>
</li>
<li><a href='#TikaAndVisionVideo-Questions/Suggestions/Improvements/Feedback?'>Questions / Suggestions / Improvements / Feedback ?</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div></p><h1 id="TikaAndVisionVideo-TikaandComputerVisionforVideos">Tika and Computer Vision for Videos</h1><p class="line874">This page describes how to make use of Object (Visual) Recognition capability of Apache Tika for videos.<span> </span>TIKA-2322 introduced a new parser to perform object recognition on videos.<span> </span>Visit<span> </span><a class="external-link" href="https://issues.apache.org/jira/browse/TIKA-2322" rel="nofollow" style="text-decoration: none;">TIKA-2322 issue on Jira</a><span> </span>or<span> </span><a class="external-link" href="https://github.com/apache/tika/pull/168" rel="nofollow" style="text-decoration: none;">pull request on Github</a><span> </span>to read the related conversation. Continue reading to get Tika up and running for object recognition in videos.</p><p class="line862">Currently, Tika utilizes<span> </span><a class="external-link" href="https://arxiv.org/abs/1602.07261" rel="nofollow" style="text-decoration: none;">Inception-V4</a><span> </span>model from<span> </span><a class="external-link" href="https://www.tensorflow.org/" rel="nofollow" style="text-decoration: none;">Tensorflow</a><span> </span>for recognizing objects in the videos.</p><p class="line867"><br/></p><h2 id="TikaAndVisionVideo-TikaandTensorflowVideoRecognition">Tika and Tensorflow Video Recognition</h2><p class="line867"><br/></p><h3 id="TikaAndVisionVideo-1.TensorflowUsingRESTServer">1. Tensorflow Using REST Server</h3><p class="line874">This is the recommended way for utilizing visual recognition capability of Tika.<span> </span>This approach uses Tensorflow over REST API.<span> </span>To get this working, we are going to start a python flask based REST API server and tell tika to connect to it.<span> </span>All these dependencies and setup complexities are isolated in docker image.</p><p class="line874">Requirements :</p><ul><li style="list-style-type: none;"><p class="line862">Docker -- Visit<span> </span><a class="external-link" href="https://www.docker.com/" rel="nofollow" style="text-decoration: none;">Docker.com</a><span> </span>and install latest version of Docker. (Note: tested on docker v17.03.1)</p></li></ul><p class="line867"><br/></p><h4 id="TikaAndVisionVideo-Step1.SetupRESTServer">Step 1. Setup REST Server</h4><p class="line874">You can either start the REST server in an isolated docker container or natively on the host that runs tensorflow.</p><p class="line867"><br/></p><h5 id="TikaAndVisionVideo-a.Usingdocker(Recommended)">a. Using docker (Recommended)</h5><p class="line867"><br/></p><p><a class="external-link" href="https://163.172.69.106/tika/TikaAndVisionVideo" rel="nofollow" style="text-decoration: none;">Toggle line numbers</a></p><pre lang="en"><span class="line"><span class="LineNumber" style="color: gray;"><a class="external-link" href="https://163.172.69.106/tika/TikaAndVisionVideo#CA-2e7123d7348f0525e7ffbd78aab12aa05af1f05c_1" rel="nofollow" style="text-decoration: none;">   1</a> </span>git clone https://github.com/USCDataScience/tika-dockers.git &amp;&amp; <span class="ResWord" style="color: rgb(160,0,0);">cd</span> tika-dockers </span>
<span class="line"><span class="LineNumber" style="color: gray;"><a class="external-link" href="https://163.172.69.106/tika/TikaAndVisionVideo#CA-2e7123d7348f0525e7ffbd78aab12aa05af1f05c_2" rel="nofollow" style="text-decoration: none;">   2</a> </span>docker build -f InceptionVideoRestDockerfile -t uscdatascience/inception-video-rest-tika .</span>
<span class="line"><span class="LineNumber" style="color: gray;"><a class="external-link" href="https://163.172.69.106/tika/TikaAndVisionVideo#CA-2e7123d7348f0525e7ffbd78aab12aa05af1f05c_3" rel="nofollow" style="text-decoration: none;">   3</a> </span>docker run -p 8764:8764 -it uscdatascience/inception-video-rest-tika</span>
</pre><p class="line862">Once it is done, test the setup by visiting<span> </span><a class="external-link" href="http://localhost:8764/inception/v4/classify/video?topn=5&amp;min_confidence=0.015&amp;url=http://dev.exiv2.org/attachments/344/MOV_0234.mp4&amp;mode=fixed&amp;ext=.m4v" rel="nofollow" style="text-decoration: none;">http://localhost:8764/inception/v4/classify/video?topn=5&amp;min_confidence=0.015&amp;url=http://dev.exiv2.org/attachments/344/MOV_0234.mp4&amp;mode=fixed&amp;ext=.m4v</a><span> </span>in your web browser.</p><p class="line867"><strong>Sample output from API:</strong></p><pre>{
        &quot;confidence&quot;: [
                0.29454298615455626,
                0.2789864711463451,
                0.08245106576941907,
                0.07252519279718399,
                0.05011849589645863
        ],
        &quot;classnames&quot;: [
                &quot;screen, CRT screen&quot;,
                &quot;hand-held computer, hand-held microcomputer&quot;,
                &quot;oscilloscope, scope, cathode-ray oscilloscope, CRO&quot;,
                &quot;monitor&quot;,
                &quot;cellular telephone, cellular phone, cellphone, cell, mobile phone&quot;
        ],
        &quot;classids&quot;: [
                783,
                591,
                689,
                665,
                488
        ],
        &quot;time&quot;: {
                &quot;read&quot;: 0,
                &quot;units&quot;: &quot;ms&quot;,
                &quot;classification&quot;: 20298
        }
}</pre><p class="line874">Note: MAC USERS:</p><ul><li style="list-style-type: none;">If you are using an older version, say, 'Docker toolbox' instead of the newer 'Docker for Mac',</li></ul><p class="line874">you need to add port forwarding rules in your Virtual Box default machine.</p><ol><li>Open the Virtual Box Manager.</li><li>Select your Docker Machine Virtual Box image.</li><li><p class="line862">Open Settings -&gt; Network -&gt; Advanced -&gt; Port Forwarding.</p></li><li>Add an appname,Host IP 127.0.0.1 and set both ports to 8764.</li></ol><p class="line867"><br/></p><h5 id="TikaAndVisionVideo-b.WithoutUsingdocker">b. Without Using docker</h5><p class="line862">If you chose to setup REST server without a docker container, you are free to manually install all the required tools specified in the<span> </span><a class="external-link" href="https://github.com/USCDataScience/tika-dockers/blob/master/InceptionVideoRestDockerfile" rel="nofollow" style="text-decoration: none;">docker file</a>.</p><p class="line874">Note: docker file has setup instructions for Ubuntu, you will have to transform those commands for your environment.</p><p class="line874">Below are the main requirements -</p><ol><li><p class="line891"><a class="external-link" href="https://wiki.apache.org/tika/TikaAndVisionVideo#Installing_Tensorflow" rel="nofollow" style="text-decoration: none;">Tensorflow</a></p></li><li><p class="line891"><a class="external-link" href="https://wiki.apache.org/tika/TikaAndVisionVideo#Installing_OpenCV" rel="nofollow" style="text-decoration: none;">OpenCV with python and video support</a></p></li><li><p class="line862">Flask and requests -<span> </span>pip install flask requests</p></li></ol><p class="line867"><br/></p><p><a class="external-link" href="https://163.172.69.106/tika/TikaAndVisionVideo" rel="nofollow" style="text-decoration: none;">Toggle line numbers</a></p><pre lang="en"><span class="line"><span class="LineNumber" style="color: gray;"><a class="external-link" href="https://163.172.69.106/tika/TikaAndVisionVideo#CA-62c32dd115bb382f29b78cd803b155699b22697e_1" rel="nofollow" style="text-decoration: none;">   1</a> </span>   python tika-parsers/src/main/resources/org/apache/tika/parser/recognition/tf/inceptionapi.py  --port 8764</span>
</pre><p class="line867"><br/></p><h4 id="TikaAndVisionVideo-Step2.CreateaTika-ConfigXMLtoenableTensorflowVideoparser.">Step 2. Create a Tika-Config XML to enable Tensorflow Video parser.</h4><ul><li style="list-style-type: none;"><p class="line862">A sample config can be found in Tika source code at<span> </span><a class="external-link" href="https://raw.githubusercontent.com/apache/tika/master/tika-parsers/src/test/resources/org/apache/tika/parser/recognition/tika-config-tflow-video-rest.xml" rel="nofollow" style="text-decoration: none;">tika-parsers/src/test/resources/org/apache/tika/parser/recognition/tika-config-tflow-video-rest.xml</a></p></li></ul><p class="line867"><strong>Here is an example:</strong></p><p><a class="external-link" href="https://163.172.69.106/tika/TikaAndVisionVideo" rel="nofollow" style="text-decoration: none;">Toggle line numbers</a></p><pre lang="en"><span class="line"><span class="LineNumber" style="color: gray;"><a class="external-link" href="https://163.172.69.106/tika/TikaAndVisionVideo#CA-99dcede0af05f76629d442b34b10de2b29d0d1da_1" rel="nofollow" style="text-decoration: none;">   1</a> </span><span class="ID" style="color: rgb(0,0,0);">&lt;properties</span><span class="ID" style="color: rgb(0,0,0);">&gt;</span></span>
<span class="line"><span class="LineNumber" style="color: gray;"><a class="external-link" href="https://163.172.69.106/tika/TikaAndVisionVideo#CA-99dcede0af05f76629d442b34b10de2b29d0d1da_2" rel="nofollow" style="text-decoration: none;">   2</a> </span>    <span class="ID" style="color: rgb(0,0,0);">&lt;parsers</span><span class="ID" style="color: rgb(0,0,0);">&gt;</span></span>
<span class="line"><span class="LineNumber" style="color: gray;"><a class="external-link" href="https://163.172.69.106/tika/TikaAndVisionVideo#CA-99dcede0af05f76629d442b34b10de2b29d0d1da_3" rel="nofollow" style="text-decoration: none;">   3</a> </span>        <span class="ID" style="color: rgb(0,0,0);">&lt;parser</span> <span class="ID" style="color: rgb(0,0,0);">class=</span><span class="String" style="color: rgb(0,64,128);">&quot;org.apache.tika.parser.recognition.ObjectRecognitionParser&quot;</span><span class="ID" style="color: rgb(0,0,0);">&gt;</span></span>
<span class="line"><span class="LineNumber" style="color: gray;"><a class="external-link" href="https://163.172.69.106/tika/TikaAndVisionVideo#CA-99dcede0af05f76629d442b34b10de2b29d0d1da_4" rel="nofollow" style="text-decoration: none;">   4</a> </span>            <span class="ID" style="color: rgb(0,0,0);">&lt;mime</span><span class="ID" style="color: rgb(0,0,0);">&gt;</span>video/mp4<span class="ID" style="color: rgb(0,0,0);">&lt;/mime&gt;</span></span>
<span class="line"><span class="LineNumber" style="color: gray;"><a class="external-link" href="https://163.172.69.106/tika/TikaAndVisionVideo#CA-99dcede0af05f76629d442b34b10de2b29d0d1da_5" rel="nofollow" style="text-decoration: none;">   5</a> </span>            <span class="ID" style="color: rgb(0,0,0);">&lt;params</span><span class="ID" style="color: rgb(0,0,0);">&gt;</span></span>
<span class="line"><span class="LineNumber" style="color: gray;"><a class="external-link" href="https://163.172.69.106/tika/TikaAndVisionVideo#CA-99dcede0af05f76629d442b34b10de2b29d0d1da_6" rel="nofollow" style="text-decoration: none;">   6</a> </span>                <span class="ID" style="color: rgb(0,0,0);">&lt;param</span> <span class="ID" style="color: rgb(0,0,0);">name=</span><span class="String" style="color: rgb(0,64,128);">&quot;topN&quot;</span> <span class="ID" style="color: rgb(0,0,0);">type=</span><span class="String" style="color: rgb(0,64,128);">&quot;int&quot;</span><span class="ID" style="color: rgb(0,0,0);">&gt;</span>4<span class="ID" style="color: rgb(0,0,0);">&lt;/param&gt;</span></span>
<span class="line"><span class="LineNumber" style="color: gray;"><a class="external-link" href="https://163.172.69.106/tika/TikaAndVisionVideo#CA-99dcede0af05f76629d442b34b10de2b29d0d1da_7" rel="nofollow" style="text-decoration: none;">   7</a> </span>                <span class="ID" style="color: rgb(0,0,0);">&lt;param</span> <span class="ID" style="color: rgb(0,0,0);">name=</span><span class="String" style="color: rgb(0,64,128);">&quot;minConfidence&quot;</span> <span class="ID" style="color: rgb(0,0,0);">type=</span><span class="String" style="color: rgb(0,64,128);">&quot;double&quot;</span><span class="ID" style="color: rgb(0,0,0);">&gt;</span>0.015<span class="ID" style="color: rgb(0,0,0);">&lt;/param&gt;</span></span>
<span class="line"><span class="LineNumber" style="color: gray;"><a class="external-link" href="https://163.172.69.106/tika/TikaAndVisionVideo#CA-99dcede0af05f76629d442b34b10de2b29d0d1da_8" rel="nofollow" style="text-decoration: none;">   8</a> </span>                <span class="ID" style="color: rgb(0,0,0);">&lt;param</span> <span class="ID" style="color: rgb(0,0,0);">name=</span><span class="String" style="color: rgb(0,64,128);">&quot;class&quot;</span> <span class="ID" style="color: rgb(0,0,0);">type=</span><span class="String" style="color: rgb(0,64,128);">&quot;string&quot;</span><span class="ID" style="color: rgb(0,0,0);">&gt;</span>org.apache.tika.parser.recognition.tf.TensorflowRESTVideoRecogniser<span class="ID" style="color: rgb(0,0,0);">&lt;/param&gt;</span></span>
<span class="line"><span class="LineNumber" style="color: gray;"><a class="external-link" href="https://163.172.69.106/tika/TikaAndVisionVideo#CA-99dcede0af05f76629d442b34b10de2b29d0d1da_9" rel="nofollow" style="text-decoration: none;">   9</a> </span>                <span class="ID" style="color: rgb(0,0,0);">&lt;param</span> <span class="ID" style="color: rgb(0,0,0);">name=</span><span class="String" style="color: rgb(0,64,128);">&quot;healthUri&quot;</span> <span class="ID" style="color: rgb(0,0,0);">type=</span><span class="String" style="color: rgb(0,64,128);">&quot;uri&quot;</span><span class="ID" style="color: rgb(0,0,0);">&gt;</span>http://localhost:8764/inception/v4/ping<span class="ID" style="color: rgb(0,0,0);">&lt;/param&gt;</span></span>
<span class="line"><span class="LineNumber" style="color: gray;"><a class="external-link" href="https://163.172.69.106/tika/TikaAndVisionVideo#CA-99dcede0af05f76629d442b34b10de2b29d0d1da_10" rel="nofollow" style="text-decoration: none;">  10</a> </span>                <span class="ID" style="color: rgb(0,0,0);">&lt;param</span> <span class="ID" style="color: rgb(0,0,0);">name=</span><span class="String" style="color: rgb(0,64,128);">&quot;apiUri&quot;</span> <span class="ID" style="color: rgb(0,0,0);">type=</span><span class="String" style="color: rgb(0,64,128);">&quot;uri&quot;</span><span class="ID" style="color: rgb(0,0,0);">&gt;</span>http://localhost:8764/inception/v4/classify/video?mode=fixed<span class="ID" style="color: rgb(0,0,0);">&lt;/param&gt;</span></span>
<span class="line"><span class="LineNumber" style="color: gray;"><a class="external-link" href="https://163.172.69.106/tika/TikaAndVisionVideo#CA-99dcede0af05f76629d442b34b10de2b29d0d1da_11" rel="nofollow" style="text-decoration: none;">  11</a> </span>            <span class="ID" style="color: rgb(0,0,0);">&lt;/params&gt;</span></span>
<span class="line"><span class="LineNumber" style="color: gray;"><a class="external-link" href="https://163.172.69.106/tika/TikaAndVisionVideo#CA-99dcede0af05f76629d442b34b10de2b29d0d1da_12" rel="nofollow" style="text-decoration: none;">  12</a> </span>        <span class="ID" style="color: rgb(0,0,0);">&lt;/parser&gt;</span></span>
<span class="line"><span class="LineNumber" style="color: gray;"><a class="external-link" href="https://163.172.69.106/tika/TikaAndVisionVideo#CA-99dcede0af05f76629d442b34b10de2b29d0d1da_13" rel="nofollow" style="text-decoration: none;">  13</a> </span>    <span class="ID" style="color: rgb(0,0,0);">&lt;/parsers&gt;</span></span>
<span class="line"><span class="LineNumber" style="color: gray;"><a class="external-link" href="https://163.172.69.106/tika/TikaAndVisionVideo#CA-99dcede0af05f76629d442b34b10de2b29d0d1da_14" rel="nofollow" style="text-decoration: none;">  14</a> </span><span class="ID" style="color: rgb(0,0,0);">&lt;/properties&gt;</span></span>
</pre><p class="line867"><strong>Description of parameters :</strong></p><p><br/></p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><td class="confluenceTd"><strong>Param Name</strong></td><td class="confluenceTd"><strong>Type</strong></td><td class="confluenceTd"><strong>Meaning</strong></td><td class="confluenceTd"><strong>Range</strong></td><td class="confluenceTd"><strong>Example</strong></td></tr><tr><td class="confluenceTd">topN</td><td class="confluenceTd">int</td><td class="confluenceTd">Number of object names to output</td><td class="confluenceTd">a non-zero positive integer</td><td class="confluenceTd">1 to receive top 1 object name.</td></tr><tr><td class="confluenceTd">minConfidence</td><td class="confluenceTd">double</td><td class="confluenceTd">Minimum confidence required to output the name of detected objects</td><td class="confluenceTd">[0.0 to 1.0] inclusive</td><td class="confluenceTd">0.9 for outputting object names iff at least 90% confident.</td></tr><tr><td class="confluenceTd">class</td><td class="confluenceTd">string</td><td class="confluenceTd">Class that implements object recognition functionality</td><td class="confluenceTd">constant string</td><td class="confluenceTd"><a class="external-link" href="http://org.apache.tika.parser.recognition.tf" rel="nofollow">org.apache.tika.parser.recognition.tf</a>.TensorflowRESTVideoRecogniser</td></tr><tr><td class="confluenceTd">healthUri</td><td class="confluenceTd">uri</td><td class="confluenceTd">The URI link to the ping service to ensure that the Video classification service is up and running.</td><td class="confluenceTd"><br/></td><td class="confluenceTd"><br/></td></tr><tr><td class="confluenceTd">apiUri</td><td class="confluenceTd">uri</td><td class="confluenceTd">The URI link to the Python OpenCV/ImageNet based Video classification service.</td><td class="confluenceTd"><br/></td><td class="confluenceTd"><br/></td></tr></tbody></table></div><p class="line867"><br/></p><h4 id="TikaAndVisionVideo-Step3:Demo">Step 3: Demo</h4><p class="line874">To use the vision capability via Tensorflow, just supply the above configuration to Tika.</p><p class="line862">For example, to use in Tika App (Assuming you have<span> </span><em>tika-app</em><span> </span>JAR and it is ready to run and you are running from the Tika src checkout dir):</p><p class="line867"><br/></p><pre>      $ java -jar tika-app/target/tika-app-1.15-SNAPSHOT.jar \
        --config=tika-parsers/src/test/resources/org/apache/tika/parser/recognition/tika-config-tflow-video-rest.xml \ 
       ./tika-parsers/src/test/resources/test-documents/testVideoMp4.mp4</pre><p class="line862">The input video is from:<span> </span><a class="external-link" href="http://www.sample-videos.com/" rel="nofollow" style="text-decoration: none;">Sample Videos.com</a>.</p><p class="line867"><a class="external-link" href="https://raw.githubusercontent.com/apache/tika/master/tika-parsers/src/test/resources/test-documents/testVideoMp4.mp4" rel="nofollow" style="text-decoration: none;">Big Rabbit coming out of his house</a></p><p class="line874">And, the top 4 detections are:</p><p><a class="external-link" href="https://163.172.69.106/tika/TikaAndVisionVideo" rel="nofollow" style="text-decoration: none;">Toggle line numbers</a></p><pre lang="en"><span class="line"><span class="LineNumber" style="color: gray;"><a class="external-link" href="https://163.172.69.106/tika/TikaAndVisionVideo#CA-018cb4282371e0c5eeafcc31c958fe8cecb9813c_1" rel="nofollow" style="text-decoration: none;">   1</a> </span>...</span>
<span class="line"><span class="LineNumber" style="color: gray;"><a class="external-link" href="https://163.172.69.106/tika/TikaAndVisionVideo#CA-018cb4282371e0c5eeafcc31c958fe8cecb9813c_2" rel="nofollow" style="text-decoration: none;">   2</a> </span><span class="ID" style="color: rgb(0,0,0);">&lt;meta</span> <span class="ID" style="color: rgb(0,0,0);">name=</span><span class="String" style="color: rgb(0,64,128);">&quot;OBJECT&quot;</span> <span class="ID" style="color: rgb(0,0,0);">content=</span><span class="String" style="color: rgb(0,64,128);">&quot;king penguin, Aptenodytes patagonica (0.19076)&quot;</span><span class="ID" style="color: rgb(0,0,0);">/&gt;</span></span>
<span class="line"><span class="LineNumber" style="color: gray;"><a class="external-link" href="https://163.172.69.106/tika/TikaAndVisionVideo#CA-018cb4282371e0c5eeafcc31c958fe8cecb9813c_3" rel="nofollow" style="text-decoration: none;">   3</a> </span><span class="ID" style="color: rgb(0,0,0);">&lt;meta</span> <span class="ID" style="color: rgb(0,0,0);">name=</span><span class="String" style="color: rgb(0,64,128);">&quot;OBJECT&quot;</span> <span class="ID" style="color: rgb(0,0,0);">content=</span><span class="String" style="color: rgb(0,64,128);">&quot;hare (0.13538)&quot;</span><span class="ID" style="color: rgb(0,0,0);">/&gt;</span></span>
<span class="line"><span class="LineNumber" style="color: gray;"><a class="external-link" href="https://163.172.69.106/tika/TikaAndVisionVideo#CA-018cb4282371e0c5eeafcc31c958fe8cecb9813c_4" rel="nofollow" style="text-decoration: none;">   4</a> </span><span class="ID" style="color: rgb(0,0,0);">&lt;meta</span> <span class="ID" style="color: rgb(0,0,0);">name=</span><span class="String" style="color: rgb(0,64,128);">&quot;OBJECT&quot;</span> <span class="ID" style="color: rgb(0,0,0);">content=</span><span class="String" style="color: rgb(0,64,128);">&quot;wallaby, brush kangaroo (0.09441)&quot;</span><span class="ID" style="color: rgb(0,0,0);">/&gt;</span></span>
<span class="line"><span class="LineNumber" style="color: gray;"><a class="external-link" href="https://163.172.69.106/tika/TikaAndVisionVideo#CA-018cb4282371e0c5eeafcc31c958fe8cecb9813c_5" rel="nofollow" style="text-decoration: none;">   5</a> </span><span class="ID" style="color: rgb(0,0,0);">&lt;meta</span> <span class="ID" style="color: rgb(0,0,0);">name=</span><span class="String" style="color: rgb(0,64,128);">&quot;OBJECT&quot;</span> <span class="ID" style="color: rgb(0,0,0);">content=</span><span class="String" style="color: rgb(0,64,128);">&quot;ice bear, polar bear, Ursus Maritimus, Thalarctos maritimus (0.09350)&quot;</span><span class="ID" style="color: rgb(0,0,0);">/&gt;</span></span>
<span class="line"><span class="LineNumber" style="color: gray;"><a class="external-link" href="https://163.172.69.106/tika/TikaAndVisionVideo#CA-018cb4282371e0c5eeafcc31c958fe8cecb9813c_6" rel="nofollow" style="text-decoration: none;">   6</a> </span>...</span>
</pre><p class="line867"><br/></p><h4 id="TikaAndVisionVideo-ChangingthedefaulttopN,APIportorURL">Changing the default topN, API port or URL</h4><p class="line862">To change the defaults, update the parameters in config XML file accordingly. Below is a description of parameters accepted by Inception REST API, they can be passed through<span> </span>apiUri<span> </span>in config file.</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><td class="confluenceTd"><p class="line862">Param Name</p></td><td class="confluenceTd"><p class="line862">Type</p></td><td class="confluenceTd"><p class="line862">Description</p></td><td class="confluenceTd"><p class="line862">Default Value</p></td></tr><tr><td colspan="1" rowspan="4" style="text-align: center;" class="confluenceTd"><p class="line862">mode</p></td><td colspan="1" rowspan="4" style="text-align: center;" class="confluenceTd"><p class="line862">string</p></td><td class="confluenceTd"><p class="line862">Available Modes of frame extraction</p></td><td colspan="1" rowspan="4" style="text-align: center;" class="confluenceTd"><p class="line862">center</p></td></tr><tr><td class="confluenceTd"><p class="line862">&quot;center&quot; - Just one frame in center</p></td></tr><tr><td class="confluenceTd"><p class="line862">&quot;interval&quot; - Extracts frames after fixed interval</p></td></tr><tr><td class="confluenceTd"><p class="line862">&quot;fixed&quot; - Extract fixed number of frames</p></td></tr><tr><td class="confluenceTd"><p class="line862">frame-interval</p></td><td class="confluenceTd"><p class="line862">int</p></td><td class="confluenceTd"><p class="line862">Interval for frame extraction to be used with INTERVAL mode. If frame_interval=10 then every 10th frame will be extracted</p></td><td class="confluenceTd"><p class="line862">10</p></td></tr><tr><td class="confluenceTd"><p class="line862">num-frame</p></td><td class="confluenceTd"><p class="line862">int</p></td><td class="confluenceTd"><p class="line862">Number of frames to be extracted from video while using FIXED model. If num_frame=10 then 10 frames equally distant from each other will be extracted</p></td><td class="confluenceTd"><p class="line862">10</p></td></tr></tbody></table></div><p class="line862">If you want to run video recognition by extracting labels from every 100th image you can make an<span> </span>apiUri<span> </span>like<span> </span><a class="external-link" href="http://localhost:8764/inception/v4/classify/video?mode=interval&amp;frame-interval=100" rel="nofollow">http://localhost:8764/inception/v4/classify/video?mode=interval&amp;frame-interval=100</a></p><p class="line867"><strong>Here is an example scenario:</strong></p><p class="line874">Run REST API on port 3030, and get top 4 object names if the confidence is above 10%. You may also change host to something else than 'localhost' if required.</p><p class="line867"><strong>Example Config File</strong></p><pre>&lt;properties&gt;
    &lt;parsers&gt;
        &lt;parser class=&quot;org.apache.tika.parser.recognition.ObjectRecognitionParser&quot;&gt;
            &lt;mime&gt;image/jpeg&lt;/mime&gt;
            &lt;params&gt;
                &lt;param name=&quot;topN&quot; type=&quot;int&quot;&gt;4&lt;/param&gt;
                &lt;param name=&quot;minConfidence&quot; type=&quot;double&quot;&gt;0.1&lt;/param&gt;
                &lt;param name=&quot;class&quot; type=&quot;string&quot;&gt;org.apache.tika.parser.recognition.tf.TensorflowRESTRecogniser&lt;/param&gt;
                &lt;param name=&quot;healthUri&quot; type=&quot;uri&quot;&gt;http://localhost:3030/inception/v4/ping&lt;/param&gt;
                &lt;param name=&quot;apiUri&quot; type=&quot;uri&quot;&gt;http://localhost:3030/inception/v4/classify/video?topk=4&lt;/param&gt;
            &lt;/params&gt;
        &lt;/parser&gt;
    &lt;/parsers&gt;
&lt;/properties&gt;</pre><p class="line867"><strong>To Start the service on port 3030:</strong></p><p class="line874">Using Docker:</p><ul><li style="list-style-type: none;"><p class="line891">docker run -it -p 3030:8764 uscdatascience/inception-video-rest-tika</p></li></ul><p class="line874">Without Using Docker:</p><p class="line867">python tika-parsers/src/main/resources/org/apache/tika/parser/recognition/tf/inceptionapi.py  --port 3030</p><p class="line867"><br/></p><hr/><p class="line874"><br/></p><h3 id="TikaAndVisionVideo-ManualInstallationguide">Manual Installation guide</h3><p class="line867"><br/></p><h4 id="TikaAndVisionVideo-InstallingTensorflow">Installing Tensorflow</h4><p class="line862">To install tensorflow, follow the instructions on<span> </span><a class="external-link" href="https://www.tensorflow.org/install/" rel="nofollow" style="text-decoration: none;">the official site here</a><span> </span>for your environment.<span> </span>Unless you know what you are doing, you are recommended to follow pip installation.</p><p class="line862">Then clone the repository<span> </span><a class="external-link" href="https://github.com/tensorflow/models" rel="nofollow" style="text-decoration: none;">tensorflow/models</a><span> </span>or download the<span> </span><a class="external-link" href="https://github.com/tensorflow/models/archive/master.zip" rel="nofollow" style="text-decoration: none;">zip file</a>.</p><ul><li style="list-style-type: none;"><p class="line891">git clone <a class="external-link" href="https://github.com/tensorflow/models.git" rel="nofollow">https://github.com/tensorflow/models.git</a></p></li></ul><p class="line874">Add 'models/slim' folder to the environment variable, PYTHONPATH.</p><ul><li style="list-style-type: none;"><p class="line891">$ export PYTHONPATH=&quot;$<a class="external-link" href="http://PYTHONPATH/path/to/models/slim" rel="nofollow">PYTHONPATH:/path/to/models/slim</a>&quot;</p></li></ul><p class="line874">To test the readiness of your environment :</p><ul><li style="list-style-type: none;"><p class="line891">$ python -c 'import tensorflow, numpy, dataset; print(&quot;OK&quot;)'</p></li></ul><p class="line874">If the above command prints the message &quot;OK&quot;, then the requirements are satisfied.</p><p class="line867"><br/></p><h4 id="TikaAndVisionVideo-InstallingOpenCV">Installing OpenCV</h4><p class="line874">OpenCV is a very popular computer vision library. We are using it to extract still images from video file. For this to work you need to install OpenCV with video support and python end point. Installation will vary from platform to platform so if you don't have enough experience with installing C packages it's a good idea to use docker build.</p><ul><li style="list-style-type: none;">- On Mac you can use homebrew to install OpenCV and make sure cv2.py is in your python path.</li></ul><p class="line867"><br/></p><pre>brew tap homebrew/science 
brew install opencv </pre><ul><li style="list-style-type: none;"><p class="line862">-<span> </span><a class="external-link" href="https://github.com/apache/tika/blob/e141640891cd7adcfc1848b351c0db7eab00a2d2/tika-parsers/src/main/resources/org/apache/tika/parser/recognition/tf/InceptionVideoRestDockerfile#L30-L64" rel="nofollow" style="text-decoration: none;">docker commands on ubuntu</a></p></li></ul><p class="line874">To verify if your setup is correct you can run below commands and they should print &quot;SUCCESS&quot;</p><p><a class="external-link" href="https://163.172.69.106/tika/TikaAndVisionVideo" rel="nofollow" style="text-decoration: none;">Toggle line numbers</a></p><pre lang="en"><span class="line"><span class="LineNumber" style="color: gray;"><a class="external-link" href="https://163.172.69.106/tika/TikaAndVisionVideo#CA-e81ddd88993077dfdb392f7f1fbe171522191250_1" rel="nofollow" style="text-decoration: none;">   1</a> </span>curl -Lo testVideoMp4.mp4  <span class="String" style="color: rgb(0,64,128);">&quot;https://github.com/apache/tika/blob/e141640891cd7adcfc1848b351c0db7eab00a2d2/tika-parsers/src/test/resources/test-documents/testVideoMp4.mp4?raw=true&quot;</span></span>
<span class="line"><span class="LineNumber" style="color: gray;"><a class="external-link" href="https://163.172.69.106/tika/TikaAndVisionVideo#CA-e81ddd88993077dfdb392f7f1fbe171522191250_2" rel="nofollow" style="text-decoration: none;">   2</a> </span>python -c <span class="String" style="color: rgb(0,64,128);">&quot;import cv2; cap = cv2.VideoCapture('testVideoMp4.mp4'); print 'SUCCESS' if cap.isOpened() else 'FAILURE'&quot;</span></span>
</pre><p class="line867"><br/></p><hr/><p class="line874"><br/></p><h3 id="TikaAndVisionVideo-Questions/Suggestions/Improvements/Feedback?">Questions / Suggestions / Improvements / Feedback ?</h3><ol><li><p class="line862">If it was useful, let us know on twitter by mentioning<span> </span><a class="external-link" href="https://twitter.com/ApacheTika" rel="nofollow" style="text-decoration: none;">@ApacheTika</a></p></li><li><p class="line862">If you have questions, let us know by<span> </span><a class="external-link" href="https://tika.apache.org/mail-lists.html" rel="nofollow" style="text-decoration: none;">using Mailing Lists</a></p></li><li><p class="line862">If you find any bugs,<span> </span><a class="external-link" href="https://issues.apache.org/jira/browse/TIKA/" rel="nofollow" style="text-decoration: none;">use Jira to report them</a></p></li></ol>
                    </div>

                                        
                 
                </div>             </div> 
            <div id="footer" role="contentinfo">
                <section class="footer-body">
                    <p>Document generated by Confluence on мая 02, 2023 15:13</p>
                    <div id="footer-logo"><a href="https://www.atlassian.com/">Atlassian</a></div>
                </section>
            </div>
        </div>     </body>
</html>
