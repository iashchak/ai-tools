<!DOCTYPE html>
<html>
    <head>
        <title>TIKA : VirtualMachine</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        <ol id="breadcrumbs">
                            <li class="first">
                                <span><a href="index.html">TIKA</a></span>
                            </li>
                                                    <li>
                                <span><a href="Home_109454051.html">Home</a></span>
                            </li>
                                                </ol>
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            TIKA : VirtualMachine
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    <div class="page-metadata">
                        
        
    
    
        
    
        
        
            Created by <span class='author'> ASF Infrabot</span>, last modified by <span class='editor'> Tim Allison</span> on дек 09, 2020
                        </div>
                    <div id="main-content" class="wiki-content group">
                    <h1 id="VirtualMachine-NotesonsettinguptheTikaVirtualMachine">Notes on setting up the Tika Virtual Machine</h1><h1 id="VirtualMachine-SeeTIKA-1331">See TIKA-1331</h1><h4 id="VirtualMachine-Installsoftware(thishasbeenupdatedforUbuntu)">Install software (this has been updated for Ubuntu)</h4><ol><li>sudo apt update</li><li>gpg<ol><li><span>sudo apt install gnupg</span></li></ol></li><li> java<ol><li><code class="highlighted">wget -qO - https://adoptopenjdk.jfrog.io/adoptopenjdk/api/gpg/key/public | sudo apt-key add -</code></li><li><code class="highlighted">sudo apt-get install -y software-properties-common</code></li><li><code class="highlighted">sudo add-apt-repository --yes <a class="external-link" href="https://adoptopenjdk.jfrog.io/adoptopenjdk/deb/" rel="nofollow">https://adoptopenjdk.jfrog.io/adoptopenjdk/deb/</a></code></li><li><code>sudo apt-get install adoptopenjdk-8-hotspot</code></li><li><code>sudo apt-get install adoptopenjdk-11-hotspot</code></li><li><code>sudo apt-get install adoptopenjdk-14-hotspot</code></li></ol></li><li><code>sudo apt-get install fontconfig (<a class="external-link" href="https://github.com/AdoptOpenJDK/openjdk-build/issues/693" rel="nofollow">https://github.com/AdoptOpenJDK/openjdk-build/issues/693</a> via Dominik Stadler)<br/></code></li><li><code>sudo apt install ttf-dejavu (same as above)</code></li><li>sudo apt-get install groovy</li><li>sudo apt-get install maven</li><li>sudo apt-get install subversion</li><li>sudo apt-get install git</li><li>sudo apt-get install file</li><li>installed docker following: <a class="external-link" href="https://docs.docker.com/engine/install/ubuntu/" rel="nofollow">https://docs.docker.com/engine/install/ubuntu/</a></li></ol><h1 id="VirtualMachine-Datasette">Datasette</h1><p>On 12 November 2020, I ran tika-eval's new FileProfile on the corpus.  This includes file type detection by Tika and by 'file', digests and file sizes.</p><p>We configured the reverse proxy for /datasette:</p><p>ProxyPreserveHost On<br/>ProxyPass /datasette <a class="external-link" href="http://0.0.0.0:8001" rel="nofollow">http://0.0.0.0:8001</a><br/>ProxyPassReverse /datasette <a class="external-link" href="http://0.0.0.0:8001" rel="nofollow">http://0.0.0.0:8001</a></p><p>The .db is in /data1/publish.  cd to that directory and then:</p><p><code>docker run --name datasette -d -p 8001:8001 -v `pwd`:/mnt datasetteproject/datasette datasette -p 8001 -h 0.0.0.0 /mnt/file_profiles.db --config sql_time_limit_ms:120000 --config max_returned_rows:100000 --config <a class="external-link" href="http://base_url/datasette/" rel="nofollow">base_url:/datasette/</a></code></p><h2 id="VirtualMachine-HTTPD">HTTPD</h2><p>/etc/apache2</p><p>public directories are symlinks in /usr/share/corpora</p><p><br/></p><h2 id="VirtualMachine-EverythingbelowhereneedstobeupdatedforUbuntu">Everything below here needs to be updated for Ubuntu</h2><h4 id="VirtualMachine-config/adminstuff">config/admin stuff</h4><p><code>nano /etc/ssh/sshd_config</code></p><ul><li>disallow root to log in</li><li>add allowed users to <a class="unresolved" href="#">AllowUsers</a></li></ul><p>Install, configure and run fail2ban. Thanks to <a class="external-link" href="http://www.tecmint.com/install-fail2ban-on-rhel-centos-fedora/" rel="nofollow">tecmint</a>.</p><p><code>yum install fail2ban</code></p><p><code>vi /etc/fail2ban/jail.conf</code></p><p><code>systemctl start fail2ban</code></p><h4 id="VirtualMachine-openingport9998forTIKA-1301">opening port 9998 for TIKA-1301</h4><p>To open port 9998:<br/><code>firewall-cmd --zone=public --add-port=9998/tcp --permanent</code></p><p><code>firewall-cmd --reload</code></p><h4 id="VirtualMachine-permissionmanagement">permission management</h4><ol><li><code>adduser &lt;user&gt; sudo</code></li></ol><p>2. <code>passwd &lt;user&gt;</code></p><p>3. <code>groupadd &lt;admingroup&gt;</code></p><p>4. <code>usermod -g &lt;admingroup&gt; &lt;user&gt;</code></p><p>5. <code>modify /etc/ssh/sshd_config to add user to <a class="unresolved" href="#">AllowUsers</a></code></p><p>6. <code>systemctl restart sshd.service</code> --restart sshd on RHEL 7</p><h4 id="VirtualMachine-mkdirs">mkdirs</h4><p>/public/corpora/govdocs1 ...</p><h4 id="VirtualMachine-prepgovdocs1">prep govdocs1</h4><ol><li><code>cp zipfilelist /public/corpora/govdocs1/archive</code></li></ol><p>2. <code>wget -i zipfilelist.txt</code></p><p>3. (go get some coffee)</p><p>4. <code>cd govdocs1/scripts</code></p><p>5. <code>groovy unzip.groovy 0</code></p><p>6. (go get some more coffee)</p><p>7. <code>groovy rmBugged.groovy</code></p><h4 id="VirtualMachine-prepnsfpolardata">prep nsfpolardata</h4><ol><li><code>scp -r &lt;user&gt;@nsfpolardata.dyndns.org:/usr/local/ndeploy/data/AcadisCrawl .</code></li></ol><p>2. (go get some coffee)</p><p>3. <code>scp -r &lt;user&gt;@nsfpolardata.dyndns.org:/usr/local/ndeploy/data/AcadisCrawl2 .</code></p><p>4. (go get some coffee)</p><p>5. <code>scp -r &lt;user&gt;@nsfpolardata.dyndns.org:/home/mattmann/polar-data/nutch_trunk/runtime/local/bin/crawlId .</code></p><p>6. (go get some coffee)</p><p>7. <code>cd /data1/public/archives/nsf-polar-data/</code></p><p>8. <code>export NUTCH_OPTS=&quot;-Xmx8192m -XX:MaxPermSize=8192m&quot;</code></p><p>9. <code>./bin/nutch dump -outputDir out -segment /data1/public/archives/nsf-polar-data/acadis/AcadisCrawl/segments/</code></p><p>10. <code>./bin/nutch dump -outputDir out2 -segment /data1/public/archives/nsf-polar-data/acadis/AcadisCrawl2/segments/</code></p><p>11. <code>./bin/nutch dump -outputDir out3 -segment /data1/public/archives/nsf-polar-data/nasa-amd/crawlId/segments/</code></p><h2 id="VirtualMachine-addmoredisc">add more disc</h2><p>From Rackspace website, add block storage volume and attach it to server.</p><ol><li><code>mkfs.ext3 /dev/xvdb</code></li></ol><p>2. <code>mkdir /data1</code></p><p>3. <code>mount /dev/xvdb /data1</code></p><p>4. <code>nano /etc/fstab</code><br/>add these lines (e.g.):<br/><code>/dev/xvdb               /data1                  ext3    defaults        1 2</code></p><p><code>/dev/xvdc               /data2                  ext3    defaults        1 2</code></p><p>4b. When you wreck the fstab file and can't log into your system after a hard reboot and you are in recovery mode:</p><p><code>blkid</code> to figure out the drive types</p><p><code>mount -t ext3 /dev/xvdb1 /mnt</code> to mount the system</p><p>4c. Before you hit 4b, try <code>mount -fav</code> to see if there are any errors in your fstab file.</p><h2 id="VirtualMachine-httpd">httpd</h2><p>config file in the usual place : /etc/httpd/conf/httpd.conf</p><ol><li>Set robots.txt to disallow all: /var/www/html</li></ol><p>2. Link data dir(s) under: /var/www/html</p><p>3. Configure config file to allow links and to show directories</p><p>4. Show long file names...add to config file: <code>IndexOptions <a class="unresolved" href="#">FancyIndexing</a> <a class="unresolved" href="#">SuppressDescription</a> <a class="unresolved" href="#">NameWidth</a>=*</code></p><p>5. start: apachectl start</p><h2 id="VirtualMachine-pdftotext">pdftotext</h2><p>Downloads from: <a class="external-link" href="https://www.xpdfreader.com/download.html" rel="nofollow">https://www.xpdfreader.com/download.html</a></p><p>Current version: 4.00; Released: 2017 Aug 10</p><ol><li>Downloaded 64-bit Linux <code>XpdfReader</code>; executed: <code>XpdfReader-linux64-4.00.01.run</code>; unpacked and cp xpdf to /usr/local/bin</li></ol><p>2. Downloaded 64-bit Linux <code>Xpdf tools</code>; unpacked and cp bin64/* to /usr/local/bin</p><p>3. Downloaded language support packages: Arabic, Chinese/simplified, Chinese/traditional, Cyrillic, Greek, Hebrew, Japanese, Korean, Latin2, Thai and Turkish; unzipped them all, cat all add-to-xpdfrc &gt;&gt; tmp_xpdfrc and cp all to /usr/local/share/xpdf</p><p>4. cat xpdf-tools-linux-4.00/doc/sample-xpdfrc tmp_xpdfrc &gt;&gt; /usr/local/etc/xpdfrc</p><p><em>NOTE:</em> We found that <em>pdftotext</em> was not correctly reading the <em>xpdfrc</em> file in this location. We found no differences in extracted text when we removed the <em>xpdfrc</em> file and when we had it there. We did find a difference, especially in CJK PDFs, when we specified the <em>xpdfrc</em> file from the commandline with the <em>-cfg</em> option.</p><h2 id="VirtualMachine-ffmpeg">ffmpeg</h2><ol><li><code>sudo yum install epel-release</code></li></ol><p>2. <code>sudo yum localinstall --nogpgcheck <a class="external-link" href="https://download1.rpmfusion.org/free/el/rpmfusion-free-release-7.noarch.rpm" rel="nofollow">https://download1.rpmfusion.org/free/el/rpmfusion-free-release-7.noarch.rpm</a> <a class="external-link" href="https://download1.rpmfusion.org/nonfree/el/rpmfusion-nonfree-release-7.noarch.rpm" rel="nofollow">https://download1.rpmfusion.org/nonfree/el/rpmfusion-nonfree-release-7.noarch.rpm</a></code></p><p>3. <code>sudo yum install ffmpeg ffmpeg-devel</code></p><h2 id="VirtualMachine-Otherdata">Other data</h2><p>See <a href="ApacheTikaHtmlEncodingStudy_109454039.html">ApacheTikaHtmlEncodingStudy</a> for a description of gathering data for TIKA-2038. See <a href="CommonCrawl3_109454042.html">CommonCrawl3</a> for a description of refreshing data for TIKA-2750. See <a class="external-link" href="https://wiki.apache.org/tika/ComparisonTikaAndPDFToText201811" rel="nofollow">ComparisonTikaAndPDFToText201811</a> for a comparison of text extracted from PDFs by Apache Tika/Apache PDFBox and pdftotext.</p><p><br/></p><h2 id="VirtualMachine-Security">Security</h2><p>Review bad logins or bad httpd requests:</p><pre>sudo tail /var/log/secure<br/>sudo vi /var/log/httpd/access_log*<br/>Block ips<br/>sudo vi /etc/hosts.deny<br/>ALL: xxx.xx.xx.xxx<br/>sudo systemctl restart sshd</pre>
                    </div>

                                        
                 
                </div>             </div> 
            <div id="footer" role="contentinfo">
                <section class="footer-body">
                    <p>Document generated by Confluence on мая 02, 2023 15:13</p>
                    <div id="footer-logo"><a href="https://www.atlassian.com/">Atlassian</a></div>
                </section>
            </div>
        </div>     </body>
</html>
